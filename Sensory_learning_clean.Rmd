---
title: "Sensory_learning"
author: "may"
date: "December 22, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Sensory learning

## packages
```{r}
#library(dplyr) #should be included in tidyverse
library(tidyverse)
#library(ggplot2)
library(reshape2)
library(dunn.test) #dunn test
library(FSA) #alternative dunn test
library(EMT) #exact multinomial test
library(boot)
library(readr)
library(lme4)
library(emmeans)
library(fitdistrplus)
library(ggpubr)
library(rstatix)

```

```{r}
## TO DO: 

## Finalize methods for comparing between the two species. 

```


################################################################################

# Import data

```{r}
LocVSound <- read_csv("LocVSound_12.14.20.csv", 
    col_types = cols(Rewarded_loc = col_character(), 
        first_hover_nextnearest = col_character(), 
        first_land_nextnearest = col_character(), 
        first_visit_nextnearest = col_character()))



SoundVSmell <- read_csv("SoundVSmell_12.14.20.csv", 
    col_types = cols( first_hover_nearest = col_character(), 
        first_land_nearest = col_character(), 
        first_visit_nearest = col_character()))

#SoundVSmell<- read.csv("~/GitHub/Sensory_learning/Sensory_learning_1/SoundVSmell_12.14.20.csv")



LocVSmell <- read_csv("LocVSmell_12.14.20.csv", 
    col_types = cols(Rewarded_loc = col_character(), 
        first_hover_nextnearest = col_character(), 
        first_land_nextnearest = col_character(), 
        first_visit_nextnearest = col_character()))

```

## checking data
```{r}
glimpse(LocVSound)
glimpse(LocVSmell)
glimpse(SoundVSmell)
ncol(LocVSound)

```


## first visits data 
```{r}
#remove columns "visits_nearest" "pct_visits_nearest"

# first_choices <- read_csv("~/GitHub/Sensory_learning/Sensory_learning_1/first_response_11.25.20.csv")
View(first_choices)

#alt way to get this, from existing data. 
#select several columns and merge them
#rewarded 1 and 2 can come from rewarded_loc, etc. 
#first_hover, first_land_first visit


#selecting relevent columns from main data, renaming to standardize
first1<- LocVSound %>% select(Bat.ID, Scorer, Date, Time, Species, Test, Rewarded_loc, Rewarded_sound, first_hover, first_land, first_visit, first_hover_nextnearest, first_land_nextnearest, first_visit_nextnearest) %>% rename( first_hover_nearest = first_hover_nextnearest, first_land_nearest =first_land_nextnearest, first_visit_nearest = first_visit_nextnearest) 



first2 <- LocVSmell %>% select(Bat.ID, Scorer, Date, Time, Species, Test, Rewarded_loc, Rewarded_smell, first_hover, first_land, first_visit, first_hover_nextnearest, first_land_nextnearest, first_visit_nextnearest) %>% rename( first_hover_nearest = first_hover_nextnearest, first_land_nearest =first_land_nextnearest, first_visit_nearest = first_visit_nextnearest)    #may rename  also standardize the nearests for combining


first3 <- SoundVSmell %>% select(Bat.ID, Scorer, Date, Time, Species, Test, Rewarded_sound, Rewarded_smell, first_hover, first_land, first_visit, first_hover_nearest, first_land_nearest, first_visit_nearest)

first_choices <- bind_rows(first1, first2, first3) 
View(first_choices)


# Remove trachops
first_choices <- subset(first_choices, first_choices$Species != "T") # no Trachops

#no need to remove nearest anymore
unique(first_choices$first_hover)
unique(first_choices$first_land)
unique(first_choices$first_visit)


first_choices$first_visit <- factor(first_choices$first_visit, levels = c("location", "sound", "smell", "neither"))

#######This removes the 'nearest' columns##########
drops <- c("vists_nearest","pct_visits_nearest")

LocVSound <- LocVSound[ , !(names(LocVSound) %in% drops)]
LocVSmell <- LocVSmell[ , !(names(LocVSmell) %in% drops)]
SoundVSmell <- SoundVSmell[ , !(names(SoundVSmell) %in% drops)]

#########This fixes names for 2 AJS 11.23.20##############
#fix name for 2 AJs:

# # Apply text change to all 3 datasets:
# all_tests <- list(LocVSound=LocVSound,LocVSmell=LocVSmell,SoundVSmell=SoundVSmell)
# all_tests <- map(all_tests, ~ .x %>% mutate(Bat.ID = str_replace(Bat.ID, "K - C091", "K-C091"), .,Bat.ID = str_replace(Bat.ID, "L- C07F", "L-C07F")))
# 
# #change columns back to factors: 
# all_tests <- map(all_tests, ~ .x 
# %>% mutate_at(vars(Bat.ID), as.factor))
# 
# #mapping back to 3 objs
# list2env(all_tests,globalenv())

######this removes trachops columns###############
## make a subset with only lophos and AJs, remove Trachops as factor level (only ran 3 trachops, they mostly dropped out before testing)
LocVSound_AJ_L= subset(LocVSound, LocVSound$Species != "T")
LocVSmell_AJ_L= subset(LocVSmell, LocVSmell$Species != "T")
SoundVSmell_AJ_L= subset(SoundVSmell, SoundVSmell$Species != "T")

LocVSound_AJ_L$Species<- factor(LocVSound_AJ_L$Species)
LocVSmell_AJ_L$Species<- factor(LocVSmell_AJ_L$Species)
SoundVSmell_AJ_L$Species<- factor(SoundVSmell_AJ_L$Species)

View(LocVSound_AJ_L)

## COLOR PALETTE SETTINGS ##

Lo <-   "#468902"       # A blue color,
Art <-"#133954"    # A green color
Mypal <- c(Lo, Art)

```


###Melting into long format and combining the 3 datasets. delete if doesn't work. 11.20.29
```{r, eval = FALSE}
# For now I'm going to comment out (or write aval = FALSE) this section, bc I realized it would take more time to gather things from the different sections, would have to call each of the columns by name, bc they are different in the different datasets. For now, I'm just going to go to the bottom of all the sections and combine them. (mLocVSound, mLocVSmell, mSoundvSmell)
#weird to put this ahead of all the exploratory things in this file, but I divided everything up and want to put this at the topish. 
#hopfully keep pct data. 
#ultimate goal to do glmm
# HAve to change loc v smell column name from "Test" to Treatment
# pull out just the relevent columns:

# #remove head when have this worked out for real
# LocVSound_AJ_L_pcts<- head(LocVSound_AJ_L[ , c("Bat.ID", "Test", "Date", "Time", "Species", "visits_loc", "visits_sound", "visits_neither", "pct_visits_loc", "pct_visits_sound", "pct_visits_neither")])
# 
# head(LocVSound_AJ_L_pcts)
# 
# ## Alternatively could just put all the rows I don't want melted into "id" in the following fuction. 
# colnames(LocVSound_AJ_L_pcts)
# 
# mLocVSound <- melt(LocVSound_AJ_L_pcts, id=c("Bat.ID","Species"))
# hist(mLocVSound$value)
# head(mLocVSound)
# 
# ###copypasta:#######
# # pull out just the relevent columns: 
# LocVSound_AJ_L_cnts<- LocVSound_AJ_L[ , c("Bat.ID", "Species", "visits_loc", "visits_sound", "visits_neither")]
# head(LocVSound_AJ_L_cnts)
# ## Alternatively could just put all the rows I don't want melted into "id" in the following fuction, which would save the rest of the data
# colnames(LocVSound_AJ_L_cnts)
# 
# mLocVSound_cnts <- melt(LocVSound_AJ_L_cnts, id=c("Bat.ID","Species"))
# head(mLocVSound_cnts)
# 
# 
# ## convenient also to just add this count value to mLocvSound, which has the proportion data. 
# 
# visits_counts<-mLocVSound_cnts$value
# mLocVSound <-cbind(mLocVSound, visits_counts)
# head(mLocVSound)
# View(mLocVSound)

```


#LOC V SOUND


```{r}

head(LocVSound)

## make a subset with only lophos and AJs, remove Trachops as factor level (only ran 3 trachops, they mostly dropped out before testing)

LocVSound_AJ_L= subset(LocVSound, LocVSound$Species != "T")
##View(LocVSound_AJ_L)
LocVSound_AJ_L$Species<- factor(LocVSound_AJ_L$Species)

#levels(LocVSound_AJ_L$Species)
```
Yes
### SUMMARIZING AVERAGE proportion of visits to each cue
```{r}
#  summarize average visits per species using dplyr
#  summarize number
#  seperate out the species
#look at histograms of responses
#  run kruskal wallace? Anova with percents? 
#  Make graphs: percentage choices for each species
# 

Avg_pct_visits<-LocVSound_AJ_L %>% group_by(Species) %>%
      summarise(avg_sound = mean(pct_visits_sound, na.rm=TRUE)*100, avg_loc= mean(pct_visits_loc, na.rm=TRUE)* 100 ,avg_neither = mean(pct_visits_neither, na.rm=TRUE)*100 )
Avg_pct_visits



 

```

SUMMARIZING AVERAGE NUMBER of of visits overall, per species
```{r}
### Can also look at the absolute number of times that a given species visits or lands on a platform (total visits)
## summary of the mean of the total visits / species mean of the total lands / species, mean of the total hovers/ species


Avg_visits_spc<-LocVSound_AJ_L %>% group_by(Species) %>%
      summarise(avg_vis = mean(total_visits, na.rm=TRUE), sd_vis = sd(total_visits), avg_lands = mean(total_lands, na.rm=TRUE), sd_lands = sd(total_lands), avg_hovers = mean(total_hovers, na.rm=TRUE), sd_hovers = sd(total_hovers) )
Avg_visits_spc
class(Avg_visits_spc)

#seems like lophos may go the the platforms more on average. At a glance: 
t.test(LocVSound_AJ_L$total_visits[LocVSound_AJ_L$Species =="AJ"], LocVSound_AJ_L$total_visits[LocVSound_AJ_L$Species =="L"])
# At least not obviously there isn't a difference in visits

#But do they land more? At a glance: 
t.test(LocVSound_AJ_L$total_lands[LocVSound_AJ_L$Species =="AJ"], LocVSound_AJ_L$total_lands[LocVSound_AJ_L$Species =="L"])

#Ya, Lophostoma are more likely to actually land than AJs
```


##STATS

## assessing normality
```{r}
## basically assessing normality
hist(LocVSound_AJ_L$pct_visits_sound[LocVSound_AJ_L$Species=="L"], breaks=6)

#not particularly normal, pretty zero weighted
head(LocVSound_AJ_L)
```



Do AJs go to one platform more than another? 
Do Lophostoma go to any platforms more than one another? 
Which? 
Is there a difference between AJs and lophostoma? (anova? )


#### Reshape data for plotting and manipulation with percents
```{r}
# pull out just the relevent columns: 
LocVSound_AJ_L_pcts<- LocVSound_AJ_L[ , c("Bat.ID", "Species", "pct_visits_loc", "pct_visits_sound", "pct_visits_neither")]
head(LocVSound_AJ_L_pcts)
## Alternatively could just put all the rows I don't want melted into "id" in the following fuction. 
colnames(LocVSound_AJ_L_pcts)

mLocVSound <- melt(LocVSound_AJ_L_pcts, id=c("Bat.ID","Species"))
hist(mLocVSound$value)
head(mLocVSound)
#rm(mLocVSound )
```
#### Reshape data for plotting and manipulation with COUNTS
```{r}
# pull out just the relevent columns: 
LocVSound_AJ_L_cnts<- LocVSound_AJ_L[ , c("Bat.ID", "Species", "visits_loc", "visits_sound", "visits_neither")]
head(LocVSound_AJ_L_cnts)
## Alternatively could just put all the rows I don't want melted into "id" in the following fuction, which would save the rest of the data
colnames(LocVSound_AJ_L_cnts)

mLocVSound_cnts <- melt(LocVSound_AJ_L_cnts, id=c("Bat.ID","Species"))
head(mLocVSound_cnts)


## convenient also to just add this count value to mLocvSound
visits_counts<-mLocVSound_cnts$value
mLocVSound <-cbind(mLocVSound, visits_counts)


```



" Did the bats fly to the three platforms the same amount? (W/in species):
independent variables: 1:  cue (3 levels)
dependent variables: 1: percent visits by bat, not independent 
AJS
####  Kruskal-wallace: AJ
```{r}
LvS_AJ_k.test<- kruskal.test(value ~ variable, data =mLocVSound[mLocVSound$Species =="AJ", ] )

LvS_AJ_k.test


```
Significant difference, bats did not fly to the three platforms equally, so post-hocs

####  Kruskal-wallace: Lophos
```{r}
LvS_L_k.test<- kruskal.test(value ~ variable, data =mLocVSound[mLocVSound$Species =="L", ] )

LvS_L_k.test
```
Significant difference, so post-hocs


"Which platforms did the bats fly to more, which were different?"

####  Man- Whitney / Wilcox: AJs
```{r}

LvS_AJ_wilhox = pairwise.wilcox.test(mLocVSound[mLocVSound$Species =="AJ", ]$value,  mLocVSound[mLocVSound$Species =="AJ", ]$variable, p.adjust.method=p.adjust.methods)
LvS_AJ_wilhox

```
AJs visited the location significantly more than they visited the sound or the control platform, there was no detectable difference between percent visits to sound or neither

####  Man- Whitney / Wilcox: Lophos
```{r}

LvS_L_wilhox = pairwise.wilcox.test(mLocVSound[mLocVSound$Species =="L", ]$value,  mLocVSound[mLocVSound$Species =="L", ]$variable, p.adjust.method=p.adjust.methods)
LvS_L_wilhox
```
Same with Lophostoma, they were significantly more likely to visit location, over sound or the control, no difference between those. 


##Dunn test post hoc: AJ
```{r}

LvS_AJ_dunn<-dunnTest(mLocVSound[mLocVSound$Species =="AJ", ]$value,  mLocVSound[mLocVSound$Species =="AJ", ]$variable, method="holm", kw=TRUE)
LvS_AJ_dunn

```

##Dunn test post hoc: Lopho
```{r}

LvS_L_dunn<-dunnTest(mLocVSound[mLocVSound$Species =="L", ]$value,  mLocVSound[mLocVSound$Species =="L", ]$variable, method="holm", kw=TRUE)
LvS_L_dunn

```


#### Nemenyi or Zar or Mann-Whitney tests for post hoc analyses?
```{r}

```


#### Do the different species go to the platforms equally?
Independent variables: species (categorical, 2 levels)
                       cue (categorical, 3 levels)
Dependent variables: # visits, proportion visits

No good non-parametric option for a 2 way anova. 

## Investigating assumptions for ANOVA Trying out transformations
```{r}

#proportion data
boxplot(value ~  variable* Species, data = mLocVSound) #box width of largest looks more than 2x larger than that of smaller
bartlett.test( value ~  interaction(variable, Species), data = mLocVSound) #Bartlett test shows variances arn't so different
# proportions don't have normal variance

# Count data also does not have homogenaity of variances boxplot(value ~  variable* Species, data = mLocVSound_cnts)
bartlett.test( value ~  interaction(variable, Species), data = mLocVSound_cnts)
# does not have homogenaity of variance

# Proportion data transformations #
mLocVSound$value_sqrt<- (sqrt(mLocVSound$value)) #sqrt transformation
mLocVSound$value_cub = sign(mLocVSound$value) * abs(mLocVSound$value)^(1/3)  #cubed transformation
mLocVSound$value_log<- (log(mLocVSound$value))#log transformation- too strong

# Count data transformations #
mLocVSound_cnts$value_sqrt<- (sqrt(mLocVSound_cnts$value)) #sqrt transformation
mLocVSound_cnts$value_cub = sign(mLocVSound_cnts$value) * abs(mLocVSound_cnts$value)^(1/3)  #cubed transformation
mLocVSound_cnts$value_log<- (log(mLocVSound_cnts$value))#log transformation- too strong

#  Proportion data boxplots #
boxplot(value ~  variable* Species, data = mLocVSound) #original
#ok
boxplot(value_sqrt ~  variable* Species, data = mLocVSound) #sqrt
##pretty good
boxplot(value_cub ~  variable* Species, data = mLocVSound) #cub, less good
boxplot(value_log ~  variable* Species, data = mLocVSound) # too strong

#Count data boxplots #
boxplot(value ~  variable* Species, data = mLocVSound_cnts) #unequal variance
boxplot(value_sqrt ~  variable* Species, data = mLocVSound_cnts) #sqrt, pretty good
boxplot(value_cub ~  variable* Species, data = mLocVSound_cnts) #cub, pretty good
boxplot(value_log ~  variable* Species, data = mLocVSound_cnts) # too strong


bartlett.test( value_log ~  interaction(variable, Species), data = mLocVSound_cnts)
## This actually seems to have fixed the homogenaity of variances problem

#normality? Less important, ANOVAs are robust against this violation
#proportions: 
hist(mLocVSound$value[mLocVSound$Species=="L"], breaks=6)
hist(mLocVSound$value_sqrt[mLocVSound$Species=="L"], breaks=6)
#hist(mLocVSound$value_cub[mLocVSound$Species=="L"], breaks=6)


#counts:
hist(mLocVSound_cnts$value[mLocVSound_cnts$Species=="L"], breaks=6)
hist(mLocVSound_cnts$value_sqrt[mLocVSound_cnts$Species=="L"], breaks=6)
hist(mLocVSound_cnts$value_cub[mLocVSound_cnts$Species=="L"], breaks=6)

hist(mLocVSound_cnts$value_log[mLocVSound_cnts$Species=="L"], breaks=8)
str(mLocVSound_cnts)
table(mLocVSound_cnts$value)
sum(mLocVSound_cnts$value == 0)

##View(mLocVSound_cnts)

```
Probably best to use count data with ANOVA, proportions may be real, so use the cube transformation
##  Anova with transformed count data, type 2
```{r}
library(car)
anova_LvS <- aov(value_cub ~ Species*variable, data=mLocVSound_cnts)
anova_LvS
Anova(anova_LvS, type = 2)

```

No obvious effect of species, only the effect of the treatments. I know this isn't a really nice way to do this, but not sure how else to do it. 
## Other Thoughts on strategies to analyze differences between spp. Do the two species go to the 3 platform types differently? 
- multilevel ordinal model?
- McNemar-Bowker (no, bc my independent variable is not matched (species)
- Ordered logistic regression? (not really, test is for an ordered, but not continous dependent variable. though '# visits' may count)
- factorial logistic regression (not really appropriate)
- chi-sq: could work, but have all these non-independent samples within bat. 
- glmm: my old favorite. Would work fine, but then would probably make sense to use it for everything, but then again, it would probably be best! 
### Chi-squared strategy
- Could change how I consider variables: 
- independent v: species (categorical, 2 levels, independent groups)
- dependent v: cue visited (categorical, 3 levels)
- Not great though. the problem: this loses the fact that there are multiple observations per bat ID. (structure within independent variable) can this be done with structure? (multiple observations/group)
- Could collapse by summing proportions for each bat. table with columns: sum of proportions of visits per each type, rows= species. idk if this is a legit way to use chi-sq
```{r}
Sum_pct_visits<-LocVSound_AJ_L %>% group_by(Species) %>%
      summarise(avg_sound = sum(pct_visits_sound, na.rm=TRUE), avg_loc= sum(pct_visits_loc, na.rm=TRUE) ,avg_neither = sum(pct_visits_neither, na.rm=TRUE) ) %>% remove_rownames %>% column_to_rownames(var="Species") %>% as.data.frame()

Sum_pct_visits
#above code groups by species, makes column for sum of proportion visits to each platform, makes into a data table with species as rownames, for use in the contingency table. 

Chi_sq_pct_visits_LvS<- Sum_pct_visits %>% chisq.test()
Chi_sq_pct_visits_LvS

#IDK if this is an acceptable use of Chi-squared
#pearson's chi-squared formula example
#chisq.test(table(female, schtyp))
```
If it is okay to do this test, the p-value is 0.58, so the two species are quite unlikely to be different for this particular test. 


## confidence intervals and bootstrapping
```{r}
## Could get the mean proportion of visits to cues from each of the species. bootstrap the mean proportion, then compare the 95% confidence intervals for each mean. (This code doesn't work as far as I know, Nov 2020)
############CODE FROM BASTI#################################################

#X will be the vector of proportions or rates or counts for one treatment in a species. It will calculate 5000 means based on re-sampling your data and then calculate the confidence intervals from that mean-distribution. 

#The function spits out a vector of three values, the lower CI, mean, and upper CI.

#This is the function used for it:
#https://www.rdocumentation.org/packages/boot/versions/1.3-20/topics/boot.ci
###########################################################################

#mean function
mean.w <- function(x,w) sum(x*w) # calculates a mean

#bootstrapped confidence intervals function
boot_ci <- function(x){
    mean <- mean(x)
    low <- boot.ci(boot(data=x, statistic=mean.w, R=5000, stype="w"), type="basic")$basic[1,4]
    high <- boot.ci(boot(data=x, statistic=mean.w, R=5000, stype="w"), type="basic")$basic[1,5]
    c(low,mean,high)} # bootstraps the confidence intervals


View(mLocVSound)
## get rid of NAs in data using complete.cases
#mLocVSound_na<-mLocVSound[complete.cases(mLocVSound[ ,4:6]), ] #removes NA rows in value columns 4:6, this might now make sense if I change the number of columns

mLocVSound_na <- mLocVSound %>% drop_na(value) #dplyr strategy
View(mLocVSound_na)

#New database without NAs in the selected columns
LocVSound_AJ_L_na <- LocVSound_AJ_L[complete.cases(LocVSound_AJ_L[ ,c("visits_loc", "visits_sound",  "visits_neither", "pct_visits_loc", "pct_visits_sound", "pct_visits_neither")]), ]

#The CI's for loc v Sound, percentages
set.seed(1)
LvS_pct_CI <- do.call(data.frame, aggregate(value ~ Species + variable , boot_ci, data = mLocVSound_na)) #This applies the bootstrap accross species and treatment variables, and do.call puts the data.frame in the right format
colnames(LvS_pct_CI) <- c("Species", "variable", "low", "mean", "high")

# The CIs for Loc V Sound, counts
LvS_count_CI <- do.call(data.frame, aggregate(visits_counts ~ Species + variable , boot_ci(), data = mLocVSound_na))
LvS_count_CI

colnames(LvS_count_CI) <- c("Species", "variable", "low", "mean", "high")


```




## Plotting

## plotting confidence intervals for pct and % visits to platforms, LvS 
```{r}
#LvS_pct_CI$Species <- factor(LvS_pct_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum")) #need to do this for plot legends to say full name

#LvS_count_CI$Species <- factor(LvS_count_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum"))


pd = position_dodge(0.5) # move bars .05 to the left and right

#proportion plot
LvS_pct_CI_p <- ggplot(data = LvS_pct_CI, aes(x=variable, y = mean, colour = Species))
LvS_pct_CI_p <- LvS_pct_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvS_pct_CI_p <- LvS_pct_CI_p + geom_point( position = pd, shape=18, size = 3)
LvS_pct_CI_p <- LvS_pct_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvS_pct_CI_p <- LvS_pct_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_sound" = "Sound",
                              "pct_visits_neither" = "Neither"))  # Relabelling X axis
LvS_pct_CI_p <- LvS_pct_CI_p + xlab("Cues")
LvS_pct_CI_p <- LvS_pct_CI_p + ylab("Mean proportion of visits")
LvS_pct_CI_p <- LvS_pct_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))


LvS_pct_CI_p                    
#ggsave("LvS_pct_CI_p.png" )

#count plot
LvS_count_CI_p <- ggplot(data = LvS_count_CI, aes(x=variable, y = mean, colour = Species))
LvS_count_CI_p <- LvS_count_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvS_count_CI_p <- LvS_count_CI_p + geom_point( position = pd, shape=18, size = 3)
LvS_count_CI_p <- LvS_count_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvS_count_CI_p <- LvS_count_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_sound" = "Sound",
                              "pct_visits_neither" = "Neither"))  # Relabelling X axis
LvS_count_CI_p <- LvS_count_CI_p + xlab("Cues")
LvS_count_CI_p <- LvS_count_CI_p + ylab("Mean number of visits")
LvS_count_CI_p <- LvS_count_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))

LvS_count_CI_p 

#ggsave("LvS_count_CI_p.png" )

```

#### Plotting % of visits to the different platforms, LvS
```{r}

#############delete me################
#Original

LocVSound_bar <- ggplot(data =mLocVSound, aes(x = variable, y = value))
LocVSound_bar <- LocVSound_bar + geom_boxplot(aes(fill=Species))
LocVSound_bar <- LocVSound_bar + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSound_bar <- LocVSound_bar + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSound_bar <- LocVSound_bar + xlab("Cues")
LocVSound_bar <- LocVSound_bar + ylab("Proportion of total visits")
LocVSound_bar <- LocVSound_bar + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_sound" = "Sound",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
#LocVSound_bar <- LocVSound_bar + scale_fill_discrete(labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSound_bar <- LocVSound_bar + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))


LocVSound_bar

##########################################
#conf int plot
pd = position_dodge(0.5) # move bars .05 to the left and right

#proportion plot
LvS_pct_CI_p <- ggplot(data = LvS_pct_CI, aes(x=variable, y = mean, colour = Species))
LvS_pct_CI_p <- LvS_pct_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvS_pct_CI_p <- LvS_pct_CI_p + geom_point( position = pd, shape=18, size = 3)
LvS_pct_CI_p <- LvS_pct_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvS_pct_CI_p <- LvS_pct_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_sound" = "Sound",
                              "pct_visits_neither" = "Neither"))  # Relabelling X axis
LvS_pct_CI_p <- LvS_pct_CI_p + xlab("Cues")
LvS_pct_CI_p <- LvS_pct_CI_p + ylab("Mean proportion of visits")
LvS_pct_CI_p <- LvS_pct_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LvS_pct_CI_p
###################deleteme##############

   
#trying to get conf infs and colnames on the same plot
#change "mean" to "value"
LvS_pct_CI_pd<-LvS_pct_CI
colnames(LvS_pct_CI_pd) <- c("Species", "variable", "low", "value", "high")
LvS_pct_CI_pd

####
pd1<- position_dodge(1.8) # move bars .05 to the left and right
      
LocVSound_bar <- ggplot(data =mLocVSound, aes(x = variable, y = value))
LocVSound_bar <- LocVSound_bar + geom_boxplot(aes(fill=Species))
LocVSound_bar <- LocVSound_bar + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent

LocVSound_bar <- LocVSound_bar + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSound_bar <- LocVSound_bar + xlab("Cues")
LocVSound_bar <- LocVSound_bar + ylab("Proportion of total visits")
LocVSound_bar <- LocVSound_bar + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_sound" = "Sound",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
#LocVSound_bar <- LocVSound_bar + scale_fill_discrete(labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSound_bar <- LocVSound_bar + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))

##trying to add in confidence intervals from above plot

#LocVSound_bar <- LocVSound_bar + geom_errorbar(data= LvS_pct_CI_pd ,aes(ymin = low, ymax = high, colour = Species ), width =.1, position = c(1, 1.5, 2, 2.5, 3, 3.5)) #adds conf int data
#LocVSound_bar <- LocVSound_bar + geom_point(data= LvS_pct_CI_pd, aes( colour = Species), position = pd1, shape=18, size = 3,) #adds mean of conf it data 

#LocVSound_bar <- LocVSound_bar + annotate("pointrange", x = c(1,1.5, 2, 2.5, 3, 3.5) , y = LvS_pct_CI$mean, ymin =  LvS_pct_CI$low , ymax = LvS_pct_CI$high ,  size = 0.6) #colour = "whatevercolor",
#plot<+plot+theme_bw()

#LocVSound_bar 


#ggsave("LocVSound_pcts.png")





```

#### Plotting absolute number of visits to the different platforms
```{r}
LocVSound_bar_cnts <- ggplot(data =mLocVSound_cnts, aes(x = variable, y = value))
LocVSound_bar_cnts <- LocVSound_bar_cnts + geom_boxplot(aes(fill=Species))
LocVSound_bar_cnts <- LocVSound_bar_cnts + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSound_bar_cnts <- LocVSound_bar_cnts + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSound_bar_cnts <- LocVSound_bar_cnts + xlab("Cues")
LocVSound_bar_cnts <- LocVSound_bar_cnts + ylab("Number of visits")
LocVSound_bar_cnts <- LocVSound_bar_cnts + scale_x_discrete(labels=c("visits_loc" = "Location", "visits_sound" = "Sound",
                              "visits_neither" = "Neither" ))  # Relabelling X axis
LocVSound_bar_cnts <- LocVSound_bar_cnts + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSound_bar_cnts

#ggsave("LocVSound_cnts.png")
```
#rm(LocVSound_bar)


##First choices/ visits by species

## Make new data frame with summary data for first visits
```{r}
head(first_choices)

fc_LocVSound<- first_choices[first_choices$Test=="LocVSound",]

#fc_LocVSound<-subset(fc_LocVSound, first_land != "nearest"| is.na(first_land)) # need is.na so doesn't delete NA rows. 

head(fc_LocVSound)



fc_LocVSound$first_visit <- factor(fc_LocVSound$first_visit, levels = c("location", "sound", "neither"))  #redo factor order, removes extra levels

unique(fc_LocVSound$first_visit)

```


```{r}
# This does the same thing, but makes a new dataframe to do it
#summarize occurances
first_visits_LvS <- as.data.frame(table(fc_LocVSound$first_visit, fc_LocVSound$Species)) #summarized by species into table
first_visits_LvS


names(first_visits_LvS)<- c("Cue", "Species", "Visits")
## For plotting purposes, need to replace 0's with a small number, not meaningful
 first_visits_LvS_fp <- first_visits_LvS #first visits for plot
 first_visits_LvS_fp[first_visits_LvS_fp == 0] <- 0.03 
 
 #reorder factor
#first_visits_LvS_fp$Cue<- factor(first_visits_LvS_fp$Cue, levels = c("location", "sound", "neither", "nearest"))
#View(first_visits_LvS_fp)

first_visits_LvS_wide <- dcast(first_visits_LvS, Cue~Species ) #reshapes into wide format
head(first_visits_LvS_wide)


```


## STATS first visit
Did the bats visit the platforms first equally?
Did the species visit differently?

# first visits, exact multinomial test: AJs

Did the bats visit the platforms equally? 
Independent variable: 0
Dependent variable: # first visits to 3 platforms, compared to random
```{r}
## MUST CHANGE THESE NUMBERS MANUALLY ##
# Did the AJs  visit the three platforms equally?
# Use exact multinomial test: categorical data, small sample sizes

# AJs are in column #2:
observed_LvS_AJ <- c(first_visits_LvS_wide[first_visits_LvS_wide=="location", 2], first_visits_LvS_wide[first_visits_LvS_wide=="neither", 2], first_visits_LvS_wide[first_visits_LvS_wide=="sound", 2])
observed_LvS_AJ    #observed number of visits to the three different platforms

prob <- rep(0.33, 3) #expected number of visits if they are all equal
prob 
mult_test_LvS_AJ <- multinomial.test(observed_LvS_AJ, prob) #exact multinomial test
mult_test_LvS_AJ # p = 0.0172  ##0.0533 is that right?


#####What kind of posthocs? Do A binomial test, with the treatment in question, and the sum of the other treatments, and then do a Boneferroni correction: divide the significance level by the number of comparisons. My significance value is: 0.0167
#http://www.biostathandbook.com/exactgof.html
observed_LvS_AJ

prob2<- c(.33, .66)

obs_LvS_AJ_loc<-c(8,3)
obs_LvS_AJ_sound <- c(1, 10)
obs_LvS_AJ_neither <- c(2, 9)

#Boneferroni: .0125 significance for posthocs
 multinomial.test(obs_LvS_AJ_loc, prob2) # p=0.0039 (significance )
 multinomial.test(obs_LvS_AJ_sound, prob2) #p = 0.0727
 multinomial.test(obs_LvS_AJ_neither, prob2) # p = 0.3588
 #with one bat fewer, less significant, marginal if at all. 
 
# Exact multinomial test suggests that This is more visits to Location that expected at random


 
```
So AJs went to Sound more than the other places

# first visits, exact multinomial test: Lophos
```{r}
## MUST CHANGE THESE NUMBERS MANUALLY ##
# Did the Lophos  visit the three platforms equally?
# Use exact multinomial test: categorical data, small sample sizes

# Ls are in column #2:
observed_LvS_L <- c(first_visits_LvS_wide[first_visits_LvS_wide=="location", 3], first_visits_LvS_wide[first_visits_LvS_wide=="neither", 3], first_visits_LvS_wide[first_visits_LvS_wide=="sound", 3])
observed_LvS_L    #observed number of visits to the three different platforms

prob <- rep(0.33, 3) #expected number of visits if they are all equal
prob 
mult_test_LvS_L <- multinomial.test(observed_LvS_L, prob) #exact multinomial test
mult_test_LvS_L # 0.3193

# Exact multinomial test suggests that this is not different than random, no posthocs needed  0.3193



prob2<- c(.33, .66)

obs_LvS_L_loc<-c(5,4)
obs_LvS_L_sound <- c(1, 8)
obs_LvS_L_neither <- c(3, 6)

#Boneferroni: .0125 significance for posthocs
 multinomial.test(obs_LvS_L_loc, prob2) # p=0.1709
 multinomial.test(obs_LvS_L_sound, prob2) #p = 0.2879
 multinomial.test(obs_LvS_L_neither, prob2) # p = 0.2731

```

Consistent with Lophostoma went to the 3 cues first equally
p=

#### Plot first visits
```{r}
First_visits_LvS_p <- ggplot(data =first_visits_LvS_fp, aes(x = Cue, y = Visits, fill = Species ))
First_visits_LvS_p <- First_visits_LvS_p + geom_bar(stat = "identity", position=position_dodge()) # need stat = identity bc just not jsut counting occurances in datasheet

First_visits_LvS_p  <- First_visits_LvS_p  + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
First_visits_LvS_p  <- First_visits_LvS_p  + scale_x_discrete( labels=c("location" = "Location", "sound" = "Sound","neither" = "Neither"))  # Relabelling X axis #rearrange bars
First_visits_LvS_p  <- First_visits_LvS_p  + xlab("Cues")
First_visits_LvS_p  <- First_visits_LvS_p  + ylab("Total visits")

First_visits_LvS_p  <- First_visits_LvS_p  + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))



  #ggsave("Loc_v_sound_first_visit.png")
First_visits_LvS_p
 # rm(First_visits_p)
```



##################################################################################

# LOC V SMELL

## Import data 
```{r}

head(LocVSmell)

## make a subset with only lophos and AJs, remove Trachops as factor level

LocVSmell_AJ_L= subset(LocVSmell, LocVSmell$Species != "T")
##View(LocVSmell_AJ_L)
LocVSmell_AJ_L$Species<- factor(LocVSmell_AJ_L$Species)
head(LocVSmell_AJ_L)
#levels(LocVSmell_AJ_L$Species)
```

SUMMARIZING AVERAGE proportion of visits to each cue
```{r}
#  summarize average visits per species using dplyr
#  summarize number
#  seperate out the species
#look at histograms of responses
#  run kruskal wallace? Anova with percents? 
#  Make graphs: percentage choices for each species
# 

Avg_pct_visits<-LocVSmell_AJ_L %>% group_by(Species) %>%
      summarise(avg_sound = mean(pct_visits_loc, na.rm=TRUE), avg_smell = mean(pct_visits_smell, na.rm=TRUE),avg_neither = mean(pct_visits_neither, na.rm=TRUE) )
Avg_pct_visits



 

```

SUMMARIZING AVERAGE number of of visits overall, per species
```{r}
### Can also look at the absolute number of times that a given species visits or lands on a platform (total visits)
## summary of the mean of the total visits / species mean of the total lands / species, mean of the total hovers/ species


Avg_visits_spc<-LocVSmell_AJ_L %>% group_by(Species) %>%
      summarise(avg_vis = mean(total_visits, na.rm=TRUE), sd_vis = sd(total_visits), avg_lands = mean(total_lands, na.rm=TRUE), sd_lands = sd(total_lands), avg_hovers = mean(total_hovers, na.rm=TRUE), sd_hovers = sd(total_hovers) )
Avg_visits_spc
class(Avg_visits_spc)

#seems like lophos may go the the platforms more on average. At a glance: 
t.test(LocVSmell_AJ_L$total_visits[LocVSmell_AJ_L$Species =="AJ"], LocVSmell_AJ_L$total_visits[LocVSmell_AJ_L$Species =="L"])

# At least here, seems that lohpo visit and land more often
```


##STATS

## assessing normality
```{r}
## basically assessing normality
hist(LocVSmell_AJ_L$pct_visits_smell[LocVSmell_AJ_L$Species=="L"], breaks=6)

#not particularly normal
head(LocVSmell_AJ_L)
```



Do AJs go to one platform more than another? 
Do Lophostoma go to any platforms more than one another? 
Which? 
Is there a difference between AJs and lophostoma? (anova? )

#### Reshape data for plotting and manipulation with percents
```{r}
# pull out just the relevent columns: 
LocVSmell_AJ_L_pcts<- LocVSmell_AJ_L[ , c("Bat.ID", "Species", "pct_visits_loc", "pct_visits_smell", "pct_visits_neither" )]
head(LocVSmell_AJ_L_pcts)
## Alternatively could just put all the rows I don't want melted into "id" in the following fuction. 
colnames(LocVSmell_AJ_L_pcts)

mLocVSmell <- melt(LocVSmell_AJ_L_pcts, id=c("Bat.ID","Species"))
head(mLocVSmell)
#rm(mLocVSmell )
```
#### Reshape data for plotting and manipulation with COUNTS
```{r}
# pull out just the relevent columns: 
LocVSmell_AJ_L_cnts<- LocVSmell_AJ_L[ , c("Bat.ID", "Species", "visits_loc", "visits_smell", "visits_neither" )]
head(LocVSmell_AJ_L_cnts)
## Alternatively could just put all the rows I don't want melted into "id" in the following fuction, which would save the rest of the data
colnames(LocVSmell_AJ_L_cnts)

mLocVSmell_cnts <- melt(LocVSmell_AJ_L_cnts, id=c("Bat.ID","Species"))
head(mLocVSmell_cnts)


## convenient also to just add this count value to mLocVSmell
visits_counts<-mLocVSmell_cnts$value
mLocVSmell <-cbind(mLocVSmell, visits_counts)


```



" Did the bats fly to the three platforms the same amount?"
AJS
####  Kruskal-wallace: AJ
```{r}
LvSm_AJ_k.test<- kruskal.test(value ~ variable, data =mLocVSmell[mLocVSmell$Species =="AJ", ] )
LvSm_AJ_k.test

LvSm_AJ_count_k.test<- kruskal.test(value ~ variable, data =mLocVSmell_cnts[mLocVSmell_cnts$Species =="AJ", ] )
LvSm_AJ_count_k.test
```
Significant difference, so post-hocs

####  Kruskal-wallace: Lophos
```{r}
LvSm_L_k.test<- kruskal.test(value ~ variable, data =mLocVSmell[mLocVSmell$Species =="L", ] )

LvSm_L_k.test

LvSm_L_cnts_k.test<- kruskal.test(value ~ variable, data =mLocVSmell_cnts[mLocVSmell_cnts$Species =="L", ] )

LvSm_L_cnts_k.test

```
Significant difference, so post-hocs


"Which platforms did the bats fly to more, which were different?"

####  Man- Whitney / Wilcox: AJs
```{r}

LvSm_AJ_wilhox = pairwise.wilcox.test(mLocVSmell[mLocVSmell$Species =="AJ", ]$value,  mLocVSmell[mLocVSmell$Species =="AJ", ]$variable, p.adjust.method=p.adjust.methods)

LvSm_AJ_wilhox
```

####  Man- Whitney / Wilcox: Lophos
```{r}

LvSm_L_wilhox = pairwise.wilcox.test(mLocVSmell[mLocVSmell$Species =="L", ]$value,  mLocVSmell[mLocVSmell$Species =="L", ]$variable, p.adjust.method=p.adjust.methods)
LvSm_L_wilhox
```



##Dunn test post hoc: AJ
```{r}

LvSm_AJ_dunn<-dunnTest(mLocVSmell[mLocVSmell$Species =="AJ", ]$value,  mLocVSmell[mLocVSmell$Species =="AJ", ]$variable, method="holm", kw=TRUE)
LvSm_AJ_dunn

```

,./##Dunn test post hoc: Lopho
```{r}

LvSm_L_dunn<-dunnTest(mLocVSmell[mLocVSmell$Species =="L", ]$value,  mLocVSmell[mLocVSmell$Species =="L", ]$variable, method="holm", kw=TRUE)
LvSm_L_dunn

```


#### Nemenyi or Zar or Mann-Whitney tests for post hoc analyses?
```{r}

```


#### Do the different species go to the platforms equally?

## Investigating assumptions for ANOVA Trying out transformations
```{r}

#proportion data
boxplot(value ~  variable* Species, data = mLocVSmell) #box width of largest looks more than 2x larger than that of smaller
bartlett.test( value ~  interaction(variable, Species), data = mLocVSmell) #Bartlett test shows variances are different
# proportions don't have normal variance

# Count data also does not have homogenaity of variances
 boxplot(value ~  variable* Species, data = mLocVSmell_cnts)
bartlett.test( value ~  interaction(variable, Species), data = mLocVSmell_cnts)
# does not have homogenaity of variance


mLocVSmell_cnts$value_sqrt<- (sqrt(mLocVSmell_cnts$value)) #sqrt transformation
mLocVSmell_cnts$value_cub = sign(mLocVSmell_cnts$value) * abs(mLocVSmell_cnts$value)^(1/3)  #cubed transformation
mLocVSmell$value_log<- (log(mLocVSmell$value))#log transformation- too strong
mLocVSmell$value_sqrt<- (sqrt(mLocVSmell$value)) #sqrt transformation
mLocVSmell$value_cub = sign(mLocVSmell$value) * abs(mLocVSmell_cnts$value)^(1/3)  #cubed transformation
mLocVSmell$value_log<- (log(mLocVSmell$value))#log transformation- too strong

boxplot(value ~  variable* Species, data = mLocVSmell) #original
boxplot(value_sqrt ~  variable* Species, data = mLocVSmell) #sqrt
boxplot(value_cub ~  variable* Species, data = mLocVSmell) #cub, pretty good
boxplot(value_log ~  variable* Species, data = mLocVSmell) # too strong

#counts
boxplot(value ~  variable* Species, data = mLocVSmell_cnts) #original
boxplot(value_sqrt ~  variable* Species, data = mLocVSmell_cnts) #sqrt, prob best
boxplot(value_cub ~  variable* Species, data = mLocVSmell_cnts) #cub, 
#boxplot(value_log ~  variable* Species, data = mLocVSmell_cnts) # too strong

bartlett.test( value_sqrt ~  interaction(variable, Species), data = mLocVSmell)
bartlett.test( value_sqrt ~  interaction(variable, Species), data = mLocVSmell_cnts)
## This actually seems to have fixed the homogenaity of variances problem

#normality? Less important, ANOVAs are robust against this violation
#proportions: 
hist(mLocVSmell$value[mLocVSmell$Species=="L"], breaks=6)
hist(mLocVSmell$value_sqrt[mLocVSmell$Species=="L"], breaks=6)
#hist(mLocVSmell$value_cub[mLocVSmell$Species=="L"], breaks=6)


#counts:
hist(mLocVSmell_cnts$value[mLocVSmell_cnts$Species=="L"], breaks=6)
hist(mLocVSmell_cnts$value_sqrt[mLocVSmell_cnts$Species=="L"], breaks=6)
hist(mLocVSmell_cnts$value_cub[mLocVSmell_cnts$Species=="L"], breaks=6)

#hist(mLocVSmell_cnts$value_log[mLocVSmell_cnts$Species=="L"], breaks=8)
str(mLocVSmell_cnts)
table(mLocVSmell_cnts$value)
sum(mLocVSmell_cnts$value == 0)
## the logged values look good but ruin the homogency of variance
## 
##View(mLocVSmell_cnts)

```

##  Anova with transformed count data, type 1,2,3
```{r}
library(car)
anova_LvSm <- aov(value_sqrt ~ Species*variable, data=mLocVSmell_cnts)
anova_LvSm
Anova(anova_LvSm, type = 2)
Anova(anova_LvSm, type = 3)

```

## confidence intervals and bootstrapping
```{r}
## Could get the mean proportion of visits to cues from each of the species. bootstrap the mean proportion, then compare the 95% confidence intervals for each mean 
############CODE FROM BASTI#################################################

#X will be the vector of proportions or rates or counts for one treatment in a species. It will calculate 5000 means based on re-sampling your data and then calculate the confidence intervals from that mean-distribution. 

#The function spits out a vector of three values, the lower CI, mean, and upper CI.

#This is the function used for it:
#https://www.rdocumentation.org/packages/boot/versions/1.3-20/topics/boot.ci
###########################################################################

#mean function
mean.w <- function(x,w) sum(x*w) # calculates a mean

#bootstrapped confidence intervals function
boot_ci <- function(x){
    mean <- mean(x)
    low <- boot.ci(boot(data=x, statistic=mean.w, R=5000, stype="w"), type="basic")$basic[1,4]
    high <- boot.ci(boot(data=x, statistic=mean.w, R=5000, stype="w"), type="basic")$basic[1,5]
    c(low,mean,high)} # bootstraps the confidence intervals



## get rid of NAs in data using complete.cases
mLocVSmell_na<-mLocVSmell[complete.cases(mLocVSmell[ ,4:8]), ] #removes NA rows in value columns 4:6, this might not make sense if I change the number of columns
head(mLocVSmell)
#New database without NAs in the selected columns
LocVSmell_AJ_L_na <- LocVSmell_AJ_L[complete.cases(LocVSmell_AJ_L[ ,c("visits_loc", "visits_smell",  "visits_neither", "pct_visits_loc", "pct_visits_smell", "pct_visits_neither")]), ]

#The CI's for sound v Smell, percentages
set.seed(1)
LvSm_pct_CI <- do.call(data.frame,aggregate(value ~ Species + variable , boot_ci, data = mLocVSmell_na)) #This applies the bootstrap accross species and treatment variables, and do.call puts the data.frame in the right format
colnames(LvSm_pct_CI) <- c("Species", "variable", "low", "mean", "high")

# The CIs for sound V Smell, counts
LvSm_count_CI <- do.call(data.frame, aggregate(visits_counts ~ Species + variable , boot_ci, data = mLocVSmell_na))
head(LvSm_count_CI)

colnames(LvSm_count_CI) <- c("Species", "variable", "low", "mean", "high")


```




## Plotting

## plotting confidence intervals for pct and % visits to platforms 
```{r}
#LvSm_pct_CI$Species <- factor(LvSm_pct_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum")) #need to do this for plot legends to say full name

#LvSm_count_CI$Species <- factor(LvSm_count_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum"))


pd = position_dodge(0.5) # move bars .05 to the left and right

#proportion plot
LvSm_pct_CI_p <- ggplot(data = LvSm_pct_CI, aes(x=variable, y = mean, colour = Species))
LvSm_pct_CI_p <- LvSm_pct_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvSm_pct_CI_p <- LvSm_pct_CI_p + geom_point( position = pd, shape=18, size = 3)
LvSm_pct_CI_p <- LvSm_pct_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
LvSm_pct_CI_p <- LvSm_pct_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvSm_pct_CI_p <- LvSm_pct_CI_p + scale_x_discrete(labels=c("pct_visits_sound" = "Location", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
LvSm_pct_CI_p <- LvSm_pct_CI_p + xlab("Cues")
LvSm_pct_CI_p <- LvSm_pct_CI_p + ylab("Mean proportion of visits")
LvSm_pct_CI_p <- LvSm_pct_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LvSm_pct_CI_p                    

#ggsave("LvSm_pct_CI_p.png")

#count plot
LvSm_count_CI_p <- ggplot(data = LvSm_count_CI, aes(x=variable, y = mean, colour = Species))
LvSm_count_CI_p <- LvSm_count_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvSm_count_CI_p <- LvSm_count_CI_p + geom_point( position = pd, shape=18, size = 3)
LvSm_count_CI_p <- LvSm_count_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
LvSm_count_CI_p <- LvSm_count_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvSm_count_CI_p <- LvSm_count_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
LvSm_count_CI_p <- LvSm_count_CI_p + xlab("Cues")
LvSm_count_CI_p <- LvSm_count_CI_p + ylab("Mean number of visits")
LvSm_count_CI_p <- LvSm_count_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LvSm_count_CI_p 

#ggsave("LvSm_count_CI_p.png" )
```
#check out nearest. Is there a weird value?

#### Plotting % of visits to the different platforms, LvSm
```{r}
LocVSmell_bar <- ggplot(data =mLocVSmell, aes(x = variable, y = value))
LocVSmell_bar <- LocVSmell_bar + geom_boxplot(aes(fill=Species))
LocVSmell_bar <- LocVSmell_bar + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSmell_bar <- LocVSmell_bar + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSmell_bar <- LocVSmell_bar + xlab("Cues")
LocVSmell_bar <- LocVSmell_bar + ylab("Proportion of total visits")
LocVSmell_bar <- LocVSmell_bar + scale_x_discrete(labels=c("pct_visits_sound" = "Location", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
LocVSmell_bar <- LocVSmell_bar +  scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSmell_bar

##ggsave("LocVSmell.png")
```

#### Plotting absolute number of visits to the different platforms
```{r}
LocVSmell_bar_cnts <- ggplot(data =mLocVSmell_cnts, aes(x = variable, y = value))
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + geom_boxplot(aes(fill=Species))
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + xlab("Cues")
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + ylab("Number of visits")
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + scale_x_discrete(labels=c("visits_loc" = "Location", "visits_smell" = "Smell",
                              "visits_neither" = "Neither" ))  # Relabelling X axis
LocVSmell_bar_cnts <- LocVSmell_bar_cnts +  scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSmell_bar_cnts

#ggsave("LocVSmell_cnts.png")
```
#rm(LocVSmell_bar)




#First choices/ visits by species

## Make new data frame with summary data for first visits
```{r}
head(first_choices)
fc_LocVSmell<- first_choices[first_choices$Test=="LocVSmell" & first_choices$first_visit!= "nearest",] #pulling out Loc V smell and cutting nearests
head(fc_LocVSmell)



fc_LocVSmell$first_visit <- factor(fc_LocVSmell$first_visit, levels = c("location", "smell", "neither"))  #redo factor order, removes extra levels

unique(fc_LocVSmell$first_visit)

```


```{r}
# This does the same thing, but makes a new dataframe to do it
#summarize occurances
first_visits_LvSm <- as.data.frame(table(fc_LocVSmell$first_visit, fc_LocVSmell$Species)) #summarized by species into table



names(first_visits_LvSm)<- c("Cue", "Species", "Visits")
## For plotting purposes, need to replace 0's with a small number, not meaningful
 first_visits_LvSm_fp <- first_visits_LvSm #first visits for plot
 first_visits_LvSm_fp[first_visits_LvSm_fp == 0] <- 0.03 
 

first_visits_LvSm_wide <- dcast(first_visits_LvSm, Cue~Species ) #reshapes into wide format
head(first_visits_LvSm_wide)


```


## STATS first visit
Did the bats visit the platforms first equally?
Did the species visit differently?
# first visits, exact multinomial test: AJs
```{r}
## MUST CHANGE THESE NUMBERS MANUALLY ##
# Did the AJs  visit the three platforms equally?
# Use exact multinomial test: categorical data, small sample sizes

# AJs are in column #2:
observed_LvSm_AJ <- c(first_visits_LvSm_wide[first_visits_LvSm_wide=="location", 2], first_visits_LvSm_wide[first_visits_LvSm_wide=="neither", 2], first_visits_LvSm_wide[first_visits_LvSm_wide=="smell", 2])
observed_LvSm_AJ    #observed number of visits to the three different platforms

prob <- rep(0.33, 3) #expected number of visits if they are all equal
prob 
mult_test_LvSm_AJ <- multinomial.test(observed_LvSm_AJ, prob) #exact multinomial test
mult_test_LvSm_AJ #0.0139

# Exact multinomial test suggests that This is more visits to Location that expected at random
#posthocs, p=0.0172

prob2<- c(.33, .66)

obs_LvSm_AJ_loc<-c(7,2)
obs_LvSm_AJ_smell <- c(0,9)
obs_LvSm_AJ_neither <- c(2,7)

#Boneferroni: .0125 significance for posthocs
 multinomial.test(obs_LvSm_AJ_loc, prob2) # p=0.0.0083
 multinomial.test(obs_LvSm_AJ_smell, prob2) #p = 0.0343
 multinomial.test(obs_LvSm_AJ_neither, prob2) # p = 0.7269

 
```
So AJs went to location more than the other places

# first visits, exact multinomial test: Lophos
```{r}
## MUST CHANGE THESE NUMBERS MANUALLY ##
# Did the Lophos  visit the three platforms equally?
# Use exact multinomial test: categorical data, small sample sizes


# Ls are in column #2:
observed_LvSm_L <- c(first_visits_LvSm_wide[first_visits_LvSm_wide=="location", 3], first_visits_LvSm_wide[first_visits_LvSm_wide=="neither", 3], first_visits_LvSm_wide[first_visits_LvSm_wide=="smell", 3])
observed_LvSm_L    #observed number of visits to the three different platforms

prob <- rep(0.33, 3) #expected number of visits if they are all equal
prob 
mult_test_LvSm_L <- multinomial.test(observed_LvSm_L, prob) #exact multinomial test
mult_test_LvSm_L #0.0056

# Exact multinomial test suggests that This is more visits to Location that expected at random
# mark
#posthocs
# I think I made an error on these before: n=9, not 11
obs_LvSm_L_loc<-c(8,1)
obs_LvSm_L_smell <- c(0,9)
obs_LvSm_L_neither <- c(1,8)

#Now showing n=10? Where did bat come from? check which is right: 
obs_LvSm_L_loc<-c(8,2)
obs_LvSm_L_smell <- c(0,9)
obs_LvSm_L_neither <- c(2,8)


#Boneferroni: .0125 significance for posthocs
 multinomial.test(obs_LvSm_L_loc, prob2) # p=0.001
 multinomial.test(obs_LvSm_L_smell, prob2) #p = 0.0343 #not quite signif with correction
 multinomial.test(obs_LvSm_L_neither, prob2) # p = 0.2879


```
Can reject null hypothesis that Lophostoma went to the 3 cues first equally
p=  0.0139

#### Plot first visits
```{r}
First_visits_LvSm_p <- ggplot(data =first_visits_LvSm_fp, aes(x = Cue, y = Visits, fill = Species ))
First_visits_LvSm_p <- First_visits_LvSm_p + geom_bar(stat = "identity", position=position_dodge()) # need stat = identity bc just not jsut counting occurances in datasheet

First_visits_LvSm_p  <- First_visits_LvSm_p  + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
First_visits_LvSm_p  <- First_visits_LvSm_p  + scale_x_discrete( labels=c("location" = "Location", "smell" = "Smell","neither" = "Neither"))  # Relabelling X axis #rearrange bars
First_visits_LvSm_p  <- First_visits_LvSm_p  + xlab("Cues")
First_visits_LvSm_p  <- First_visits_LvSm_p  + ylab("Total visits")
First_visits_LvSm_p  <- First_visits_LvSm_p  + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum", "T" = "T. cirrhosus"))

First_visits_LvSm_p

  #ggsave("Loc_v_smell_first_visit.png")
 # rm(First_visits_LvSm_p)
```









######SOUND V SMELL#######################




# SOUND V SMELL

## Import data 
```{r}

head(SoundVSmell)

## make a subset with only lophos and AJs, remove Trachops as factor level

SoundVSmell_AJ_L= subset(SoundVSmell, SoundVSmell$Species != "T")
##View(SoundVSmell_AJ_L)
SoundVSmell_AJ_L$Species<- factor(SoundVSmell_AJ_L$Species)
head(SoundVSmell_AJ_L)
#levels(SoundVSmell_AJ_L$Species)
```

SUMMARIZING AVERAGE proportion of visits to each cue
```{r}
#  summarize average visits per species using dplyr
#  summarize number
#  seperate out the species
#look at histograms of responses
#  run kruskal wallace? Anova with percents? 
#  Make graphs: percentage choices for each species
# 

Avg_pct_visits<-SoundVSmell_AJ_L %>% group_by(Species) %>%
      summarise(avg_sound = mean(pct_visits_sound, na.rm=TRUE), avg_smell = mean(pct_visits_smell, na.rm=TRUE),avg_neither = mean(pct_visits_neither, na.rm=TRUE) )
Avg_pct_visits



 

```

SUMMARIZING AVERAGE number of of visits overall, per species
```{r}
### Can also look at the absolute number of times that a given species visits or lands on a platform (total visits)
## summary of the mean of the total visits / species mean of the total lands / species, mean of the total hovers/ species


Avg_visits_spc<-SoundVSmell_AJ_L %>% group_by(Species) %>%
      summarise(avg_vis = mean(total_visits, na.rm=TRUE), sd_vis = sd(total_visits), avg_lands = mean(total_lands, na.rm=TRUE), sd_lands = sd(total_lands), avg_hovers = mean(total_hovers, na.rm=TRUE), sd_hovers = sd(total_hovers) )
Avg_visits_spc


#Both visit the same, but lophos probably land more: 
t.test(SoundVSmell_AJ_L$total_visits[SoundVSmell_AJ_L$Species =="AJ"], SoundVSmell_AJ_L$total_visits[SoundVSmell_AJ_L$Species =="L"])

t.test(SoundVSmell_AJ_L$total_hovers[SoundVSmell_AJ_L$Species =="AJ"], SoundVSmell_AJ_L$total_visits[SoundVSmell_AJ_L$Species =="L"])

t.test(SoundVSmell_AJ_L$total_lands[SoundVSmell_AJ_L$Species =="AJ"], SoundVSmell_AJ_L$total_visits[SoundVSmell_AJ_L$Species =="L"])

# At least here, seems that lophos land more, both visit the same amount
```


##STATS

## assessing normality
```{r}
## basically assessing normality
hist(SoundVSmell_AJ_L$pct_visits_smell[SoundVSmell_AJ_L$Species=="L"], breaks=6)

#not particularly normal
head(SoundVSmell_AJ_L)
```



Do AJs go to one platform more than another? 
Do Lophostoma go to any platforms more than one another? 
Which? 
Is there a difference between AJs and lophostoma? (anova? )

#### Reshape data for plotting and manipulation with percents
```{r}
# pull out just the relevent columns: 
SoundVSmell_AJ_L_pcts<- SoundVSmell_AJ_L[ , c("Bat.ID", "Species", "pct_visits_sound", "pct_visits_smell", "pct_visits_neither" )]
head(SoundVSmell_AJ_L_pcts)
## Alternatively could just put all the rows I don't want melted into "id" in the following fuction. 
colnames(SoundVSmell_AJ_L_pcts)

mSoundVSmell <- melt(SoundVSmell_AJ_L_pcts, id=c("Bat.ID","Species"))
head(mSoundVSmell)
#rm(mSoundVSmell )
```
#### Reshape data for plotting and manipulation with COUNTS
```{r}
###notes####

##############
# pull out just the relevent columns: 
SoundVSmell_AJ_L_cnts<- SoundVSmell_AJ_L[ , c("Bat.ID", "Species", "visits_sound", "visits_smell", "visits_neither" )]
head(SoundVSmell_AJ_L_cnts)
## Alternatively could just put all the rows I don't want melted into "id" in the following fuction, which would save the rest of the data
colnames(SoundVSmell_AJ_L_cnts)

mSoundVSmell_cnts <- melt(SoundVSmell_AJ_L_cnts, id=c("Bat.ID","Species"))
head(mSoundVSmell_cnts)
nrow(mSoundVSmell_cnts)

## convenient also to just add this count value to mSoundVSmell
visits_counts<-mSoundVSmell_cnts$value
mSoundVSmell <-cbind(mSoundVSmell, visits_counts)
head(mSoundVSmell)
##############################
#glmm speculation
#lands and hovers ~ species (binary) + smell + sound
SvSm_aj_glmm <- glmer(value ~ variable + Species + (1|Bat.ID), family= "poisson", data = mSoundVSmell_cnts)
summary(SvSm_aj_glmm)

##################################
```



" Did the bats fly to the three platforms the same amount?"
AJS
####  Kruskal-wallace: AJ
```{r}
SovSm_AJ_k.test<- kruskal.test(value ~ variable, data =mSoundVSmell[mSoundVSmell$Species =="AJ", ] )
SovSm_AJ_k.test

SovSm_AJ_count_k.test<- kruskal.test(value ~ variable, data =mSoundVSmell_cnts[mSoundVSmell_cnts$Species =="AJ", ] )
SovSm_AJ_count_k.test

# Yes, there's no difference in the amount that AJ's flew to the different platforms
```
No significant difference, so no post-hocs

####  Kruskal-wallace: Lophos
```{r}
SovSm_L_k.test<- kruskal.test(value ~ variable, data =mSoundVSmell[mSoundVSmell$Species =="L", ] )

SovSm_L_k.test

SovSm_L_cnts_k.test<- kruskal.test(value ~ variable, data =mSoundVSmell_cnts[mSoundVSmell_cnts$Species =="L", ] )

SovSm_L_cnts_k.test


``` 
<!-- #No Significant difference, so no post-hocs -->


<!-- "Which platforms did the bats fly to more, which were different?" -->

<!-- ####  Man- Whitney / Wilcox: AJs -->
<!-- ```{r} -->

<!-- SovSm_AJ_wilhox = pairwise.wilcox.test(mSoundVSmell[mSoundVSmell$Species =="AJ", ]$value,  mSoundVSmell[mSoundVSmell$Species =="AJ", ]$variable, p.adjust.method=p.adjust.methods) -->
<!-- SovSm_AJ_wilhox -->
<!-- ``` -->

<!-- ####  Man- Whitney / Wilcox: Lophos -->
<!-- ```{r} -->

<!-- SovSm_L_wilhox = pairwise.wilcox.test(mSoundVSmell[mSoundVSmell$Species =="L", ]$value,  mSoundVSmell[mSoundVSmell$Species =="L", ]$variable, p.adjust.method=p.adjust.methods) -->
<!-- SovSm_L_wilhox -->
<!-- ``` -->



<!-- ##Dunn test post hoc: AJ -->
<!-- ```{r} -->

<!-- SovSm_AJ_dunn<-dunnTest(mSoundVSmell[mSoundVSmell$Species =="AJ", ]$value,  mSoundVSmell[mSoundVSmell$Species =="AJ", ]$variable, method="holm", kw=TRUE) -->
<!-- SovSm_AJ_dunn -->

<!-- ``` -->

<!-- ##Dunn test post hoc: Lopho -->
<!-- ```{r} -->

<!-- SovSm_L_dunn<-dunnTest(mSoundVSmell[mSoundVSmell$Species =="L", ]$value,  mSoundVSmell[mSoundVSmell$Species =="L", ]$variable, method="holm", kw=TRUE) -->
<!-- SovSm_L_dunn -->

<!-- ``` -->


<!-- #### Nemenyi or Zar or Mann-Whitney tests for post hoc analyses? -->
<!-- ```{r} -->

<!-- ``` -->


<!-- #### Do the different species go to the platforms equally? -->

## Investigating assumptions for ANOVA Trying out transformations
```{r}

#proportion data
boxplot(value ~  variable* Species, data = mSoundVSmell) #box width of largest looks more than 2x larger than that of smaller
bartlett.test( value ~  interaction(variable, Species), data = mSoundVSmell) #Bartlett test shows variances are different
# proportions don't have normal variance

# Count data also does not have homogenaity of variances
 boxplot(value ~  variable* Species, data = mSoundVSmell_cnts)
bartlett.test( value ~  interaction(variable, Species), data = mSoundVSmell_cnts)
# does not have homogenaity of variance


mSoundVSmell_cnts$value_sqrt<- (sqrt(mSoundVSmell_cnts$value)) #sqrt transformation
mSoundVSmell_cnts$value_cub = sign(mSoundVSmell_cnts$value) * abs(mSoundVSmell_cnts$value)^(1/3)  #cubed transformation
mSoundVSmell$value_log<- (log(mSoundVSmell$value))#log transformation- too strong
mSoundVSmell$value_sqrt<- (sqrt(mSoundVSmell$value)) #sqrt transformation
mSoundVSmell$value_cub = sign(mSoundVSmell$value) * abs(mSoundVSmell_cnts$value)^(1/3)  #cubed transformation
mSoundVSmell$value_log<- (log(mSoundVSmell$value))#log transformation- too strong

boxplot(value ~  variable* Species, data = mSoundVSmell) #original
boxplot(value_sqrt ~  variable* Species, data = mSoundVSmell) #sqrt
boxplot(value_cub ~  variable* Species, data = mSoundVSmell) #cub, pretty good
boxplot(value_log ~  variable* Species, data = mSoundVSmell) # too strong

#counts
boxplot(value ~  variable* Species, data = mSoundVSmell_cnts) #original
boxplot(value_sqrt ~  variable* Species, data = mSoundVSmell_cnts) #sqrt, prob best
boxplot(value_cub ~  variable* Species, data = mSoundVSmell_cnts) #cub, 
#boxplot(value_log ~  variable* Species, data = mSoundVSmell_cnts) # too strong

bartlett.test( value_sqrt ~  interaction(variable, Species), data = mSoundVSmell)
bartlett.test( value_sqrt ~  interaction(variable, Species), data = mSoundVSmell_cnts)
## This actually seems to have fixed the homogenaity of variances problem

#normality? Less important, ANOVAs are robust against this violation
#proportions: 
hist(mSoundVSmell$value[mSoundVSmell$Species=="L"], breaks=6)
hist(mSoundVSmell$value_sqrt[mSoundVSmell$Species=="L"], breaks=6)
#hist(mSoundVSmell$value_cub[mSoundVSmell$Species=="L"], breaks=6)


#counts:
hist(mSoundVSmell_cnts$value[mSoundVSmell_cnts$Species=="L"], breaks=6)
hist(mSoundVSmell_cnts$value_sqrt[mSoundVSmell_cnts$Species=="L"], breaks=6)
hist(mSoundVSmell_cnts$value_cub[mSoundVSmell_cnts$Species=="L"], breaks=6)

#hist(mSoundVSmell_cnts$value_log[mSoundVSmell_cnts$Species=="L"], breaks=8)
str(mSoundVSmell_cnts)
table(mSoundVSmell_cnts$value)


## the logged values look good but ruin the homogency of variance
## THe square root transformation does well
##View(mSoundVSmell_cnts)

```

##  Anova with transformed count data, type 1,2,3
```{r}
library(car)
anova_SovSm <- aov(value_sqrt ~ Species*variable, data=mSoundVSmell_cnts)
anova_SovSm
Anova(anova_SovSm, type = 2)
Anova(anova_SovSm, type = 3)

```

## confidence intervals and bootstrapping
```{r, eval = FALSE}
## Could get the mean proportion of visits to cues from each of the species. bootstrap the mean proportion, then compare the 95% confidence intervals for each mean 
############CODE FROM BASTI#################################################

#X will be the vector of proportions or rates or counts for one treatment in a species. It will calculate 5000 means based on re-sampling your data and then calculate the confidence intervals from that mean-distribution. 

#The function spits out a vector of three values, the lower CI, mean, and upper CI.

#This is the function used for it:
#https://www.rdocumentation.org/packages/boot/versions/1.3-20/topics/boot.ci
# ###########################################################################
# 
# #mean function
# mean.w <- function(x,w) sum(x*w) # calculates a mean
# 
# #bootstrapped confidence intervals function
# boot_ci <- function(x){
#     mean <- mean(x)
#     low <- boot.ci(boot(data=x, statistic=mean.w, R=5000, stype="w"), type="basic")$basic[1,4]
#     high <- boot.ci(boot(data=x, statistic=mean.w, R=5000, stype="w"), type="basic")$basic[1,5]
#     c(low,mean,high)} # bootstraps the confidence intervals
# 
# 
# 
# ## get rid of NAs in data using complete.cases
# mSoundVSmell_na<-mSoundVSmell[complete.cases(mSoundVSmell[ ,4:8]), ] #removes NA rows in value columns 4:6, this might not make sense if I change the number of columns
# head(mSoundVSmell)
# #New database without NAs in the selected columns
# SoundVSmell_AJ_L_na <- SoundVSmell_AJ_L[complete.cases(SoundVSmell_AJ_L[ ,c("visits_sound", "visits_smell",  "visits_neither", "pct_visits_sound", "pct_visits_smell", "pct_visits_neither")]), ]
# 
# #The CI's for sound v Smell, percentages
# set.seed(1)
# SovSm_pct_CI <- do.call(data.frame,aggregate(value ~ Species + variable , boot_ci, data = mSoundVSmell_na)) #This applies the bootstrap accross species and treatment variables, and do.call puts the data.frame in the right format
# colnames(SovSm_pct_CI) <- c("Species", "variable", "low", "mean", "high")
# 
# # The CIs for sound V Smell, counts
# SovSm_count_CI <- do.call(data.frame, aggregate(visits_counts ~ Species + variable , boot_ci, data = mSoundVSmell_na))
# SovSm_count_CI
# 
# colnames(SovSm_count_CI) <- c("Species", "variable", "low", "mean", "high")


```




## Plotting

## plotting confidence intervals for pct and % visits to platforms 
```{r}
#SovSm_pct_CI$Species <- factor(SovSm_pct_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum")) #need to do this for plot legends to say full name

#SovSm_count_CI$Species <- factor(SovSm_count_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum"))


pd = position_dodge(0.5) # move bars .05 to the left and right

#proportion plot
SovSm_pct_CI_p <- ggplot(data = SovSm_pct_CI, aes(x=variable, y = mean, colour = Species))
SovSm_pct_CI_p <- SovSm_pct_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
SovSm_pct_CI_p <- SovSm_pct_CI_p + geom_point( position = pd, shape=18, size = 3)
SovSm_pct_CI_p <- SovSm_pct_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
SovSm_pct_CI_p <- SovSm_pct_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

SovSm_pct_CI_p <- SovSm_pct_CI_p + scale_x_discrete(labels=c("pct_visits_sound" = "Sound", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
SovSm_pct_CI_p <- SovSm_pct_CI_p + xlab("Cues")
SovSm_pct_CI_p <- SovSm_pct_CI_p + ylab("Mean proportion of visits")
SovSm_pct_CI_p <- SovSm_pct_CI_p +  scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SovSm_pct_CI_p                    
#ggsave("SovSm_pct_CI_p.png" )

#count plot
SovSm_count_CI_p <- ggplot(data = SovSm_count_CI, aes(x=variable, y = mean, colour = Species))
SovSm_count_CI_p <- SovSm_count_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
SovSm_count_CI_p <- SovSm_count_CI_p + geom_point( position = pd, shape=18, size = 3)
SovSm_count_CI_p <- SovSm_count_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
SovSm_count_CI_p <- SovSm_count_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

SovSm_count_CI_p <- SovSm_count_CI_p + scale_x_discrete(labels=c("pct_visits_sound" = "Sound", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
SovSm_count_CI_p <- SovSm_count_CI_p + xlab("Cues")
SovSm_count_CI_p <- SovSm_count_CI_p + ylab("Mean proportion of visits")
SovSm_count_CI_p <- SovSm_count_CI_p +  scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SovSm_count_CI_p   

#ggsave("SovSm_count_CI_p.png")

```
#check out nearest. Is there a weird value?

#### Plotting % of visits to the different platforms
```{r}
SoundVSmell_bar <- ggplot(data =mSoundVSmell, aes(x = variable, y = value))
SoundVSmell_bar <- SoundVSmell_bar + geom_boxplot(aes(fill=Species))
SoundVSmell_bar <- SoundVSmell_bar + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
SoundVSmell_bar <- SoundVSmell_bar + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
SoundVSmell_bar <- SoundVSmell_bar + xlab("Cues")
SoundVSmell_bar <- SoundVSmell_bar + ylab("Proportion of total visits")
SoundVSmell_bar <- SoundVSmell_bar + scale_x_discrete(labels=c("pct_visits_sound" = "Sound", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
SoundVSmell_bar <- SoundVSmell_bar + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SoundVSmell_bar

#ggsave("SoundVSmell.png")
```

#### Plotting absolute number of visits to the different platforms
```{r}
SoundVSmell_bar_cnts <- ggplot(data =mSoundVSmell_cnts, aes(x = variable, y = value))
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + geom_boxplot(aes(fill=Species))
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + xlab("Cues")
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + ylab("Number of visits")
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + scale_x_discrete(labels=c("visits_sound" = "Sound", "visits_smell" = "Smell",
                              "visits_neither" = "Neither" ))  # Relabelling X axis
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SoundVSmell_bar_cnts

#ggsave("SoundVSmell_cnts.png")
```
#rm(SoundVSmell_bar)



#First choices/ visits by species

## Make new data frame with summary data for first visits
```{r}
head(first_choices)
fc_SoundVSmell<- first_choices[first_choices$Test=="SovSm" & first_choices$first_visit!= "nearest",] #pulling out Loc V smell and cutting nearests, 
head(fc_SoundVSmell)



fc_SoundVSmell$first_visit <- factor(fc_SoundVSmell$first_visit, levels = c("sound", "smell", "neither"))  #redo factor order, removes extra levels

unique(fc_SoundVSmell$first_visit)

```


```{r}
# This does the same thing, but makes a new dataframe to do it
#summarize occurances
first_visits_SvSm <- as.data.frame(table(fc_SoundVSmell$first_visit, fc_SoundVSmell$Species)) #summarized by species into table



names(first_visits_SvSm)<- c("Cue", "Species", "Visits")
## For plotting purposes, need to replace 0's with a small number, not meaningful
 first_visits_SvSm_fp <- first_visits_SvSm #first visits for plot
 first_visits_SvSm_fp[first_visits_SvSm_fp == 0] <- 0.03 
 
 
first_visits_SvSm_wide <- dcast(first_visits_SvSm, Cue~Species ) #reshapes into wide format
head(first_visits_SvSm_wide)


```


## STATS first visit
Did the bats visit the platforms first equally?
Did the species visit differently?
# first visits, exact multinomial test: AJs
```{r}
## MUST CHANGE THESE NUMBERS MANUALLY ##
# Did the AJs  visit the three platforms equally?
# Use exact multinomial test: categorical data, small sample sizes

# AJs are in column #2:
observed_SvSm_AJ <- c(first_visits_SvSm_wide[first_visits_SvSm_wide=="sound", 2], first_visits_SvSm_wide[first_visits_SvSm_wide=="smell", 2], first_visits_SvSm_wide[first_visits_SvSm_wide=="neither", 2])
observed_SvSm_AJ    #observed number of visits to the three different platforms

prob <- rep(0.33, 3) #expected number of visits if they are all equal
prob 
mult_test_SvSm_AJ <- multinomial.test(observed_SvSm_AJ, prob) #exact multinomial test
mult_test_SvSm_AJ

# Exact multinomial test suggests that these are not different than random


 
```
So no difference bt choices

# first visits, exact multinomial test: Lophos
```{r}
## MUST CHANGE THESE NUMBERS MANUALLY ##
# Did the Lophoss  visit the three platforms equally?
# Use exact multinomial test: categorical data, small sample sizes

# Ls are in column #3:
observed_SvSm_L <- c(first_visits_SvSm_wide[first_visits_SvSm_wide=="sound", 3], first_visits_SvSm_wide[first_visits_SvSm_wide=="smell", 3], first_visits_SvSm_wide[first_visits_SvSm_wide=="neither", 3])
observed_SvSm_L    #observed number of visits to the three different platforms

prob <- rep(0.33, 3) #expected number of visits if they are all equal
 
mult_test_SvSm_L <- multinomial.test(observed_SvSm_L, prob) #exact multinomial test
mult_test_SvSm_L

# Exact multinomial test suggests that these are not different than random



```
Can NOT reject null hypothesis that Lophostoma went to the 3 cues first equally
p=  0.0139

#### Plot first visits
```{r}
First_visits_SvSm_p <- ggplot(data =first_visits_SvSm_fp, aes(x = Cue, y = Visits, fill = Species ))
First_visits_SvSm_p <- First_visits_SvSm_p + geom_bar(stat = "identity", position=position_dodge()) # need stat = identity bc just not jsut counting occurances in datasheet

First_visits_SvSm_p  <- First_visits_SvSm_p  + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
First_visits_SvSm_p  <- First_visits_SvSm_p  + scale_x_discrete( labels=c("sound" = "Sound", "smell" = "Smell","neither" = "Neither"))  # Relabelling X axis #rearrange bars
First_visits_SvSm_p  <- First_visits_SvSm_p  + xlab("Cues")
First_visits_SvSm_p  <- First_visits_SvSm_p  + ylab("Number of bats that visited cue first")
First_visits_SvSm_p  <- First_visits_SvSm_p  + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))

First_visits_SvSm_p

  #ggsave("Sound_v_smell_first_visit.png")
 # rm(First_visits_SvSm_p)
```



#########################################################################

#First combining the melted datasets

# Putting dataset all together
```{r}
mLocVSound$Test <- "LocVSound"
mLocVSmell$Test <- "LocVSmell"
mSoundVSmell$Test <- "SoundVSmell"

m_Alltests <- rbind(mLocVSound, mLocVSmell,mSoundVSmell) #combine datasets

#fix name for 2 AJs:
m_Alltests <- m_Alltests %>% mutate(Bat.ID = str_replace(Bat.ID, "K - C091", "K-C091"), Bat.ID = str_replace(Bat.ID, "L- C07F", "L-C07F")) 

#2 ways to factors (base and dplyr)
m_Alltests$Bat.ID <- as.factor(m_Alltests$Bat.ID)
m_Alltests$Test <- m_Alltests$Test  %>% as.factor()



#I don't think the transformed columns make sense bc they were in different orders, so deleting them for now:
m_Alltests <- select(m_Alltests, -c(value_sqrt, value_cub, value_log))
#renaming columns to be more informative: proportion of visits= visits_prop, total visits =visits_counts, cue type = cue
#rename(new variable name = existing variable name)
m_Alltests <- m_Alltests %>% rename(visits_prop =value, cue =variable)

str(m_Alltests)
```

## Data split by Test
```{r}
SvSm <- m_Alltests %>% filter(Test == "SoundVSmell") 
LvSm <- m_Alltests %>% filter(Test == "LocVSmell") 
LvSo <- m_Alltests %>% filter(Test == "LocVSound") 
```

## Data split by Test and Species (in case I want it)
```{r}
#repeat J in SvSm_AJ
SvSm_AJ <- SvSm %>% filter(Species == "AJ") %>% droplevels() #used droplevels to get rid of unused lopho levels. Friedman test won't run without this bc it thinks it's not an unreplicated block design
SvSm_AJ$cue <- SvSm_AJ$cue  %>% as.factor()
SvSm_L <- SvSm %>% filter(Species == "L") %>% droplevels()
LvSm_AJ <- LvSm %>% filter(Species == "AJ") %>% droplevels() #A-L
LvSm_L <- LvSm %>% filter(Species == "L") %>% droplevels()
LvSo_AJ <- LvSo %>% filter(Species == "AJ") %>% droplevels()
LvSo_L <- LvSo %>% filter(Species == "L") %>% droplevels()
```


## Using Friedman tests and posthocs to compare whether bats of each species went to groups differently
- Friedman tests are more appropriate than Kruskal- Wallace tests bc I have bat ID as a blocking factor. (groups aren't independent). # vists (data) is explained by cue (groups), and blocks (bats)
```{r}

#could I do it for all subsets at the same time? sure can: 

#make version of m_alltests with no NAs:
m_Alltests1 <- drop_na(m_Alltests)

#run friedman test, grouping by species and test, using droplevels to get rid of unused factor levels in each subset, and running friedman test on each subset. yay:
friedman_all <- m_Alltests1 %>% group_by(Test, Species) %>% droplevels() %>% 
friedman_test(visits_prop ~ cue | Bat.ID)
friedman_all
  
#write_csv(friedman_all, "friedman_tests.csv")

####copy pasta######
# #Other ways to code this (with differently subsetting data. Nice to do all together, as above)
# #one way to code (with subsetted data)
# fried_SvSm_AJ <- friedman.test(visits_counts ~ cue | Bat.ID, data = SvSm_AJ) #na.action =  na.omit fried_SvSm_AJ 
# fried_SvSm_AJ 
# 
# #could also call this way (not subsetted): 
# frieds_SvSm <- m_Alltests %>% filter(Test == "SoundVSmell", Species == "AJ") %>% droplevels() %>% friedman_test(visits_counts ~ cue | Bat.ID)
# frieds_SvSm_AJ
##################3
```


#Using GLMM, EMMEANS to compare the difference in visits between species.

## GLMM and EMMEANS for differences b/t species test 11.20.20

```{r}
#Add cohort?
# try geeglm( (might have quasipoisson option)
#install.packages("geeglm")  #not abavilable this version of R...
#library(geeglm)
#glmm speculation

#test fit by ratio of 
#df resid : teh residual degrees of freedom
#to deviance



#lands and hovers ~ species (binary) + smell + sound
# model: visits_counts ~ cue +cue:Species


#Run all 3 tests: 
glmm_bytest<- lapply(split(m_Alltests1,m_Alltests1$Test),
       glmer,formula=visits_counts ~ cue*Species + (1|Bat.ID), family = "poisson")
glmm_bytest

#deviance/df = 8.38
##assessing fit
plot(glmm_bytest$LocVSmell)
EP <- residuals(glmm_bytest$LocVSmell,type="deviance")
plot(EP~fitted(glmm_bytest$LocVSmell))
qqnorm(EP)
qqline(EP)




library(MASS)
library(vcd)
data(quine) 
fit <- goodfit(m_Alltests1$visits_counts) 
summary(fit) 
rootogram(fit) #seems like my data re pretty off an idea fit 


#negative binomial model any better? 
glmm.nb_bytest<- lapply(split(m_Alltests1,m_Alltests1$Test),
       glmer.nb,formula=visits_counts ~ cue*Species + (1|Bat.ID), family = "poisson")
glmm.nb_bytest
# deviance/ df.resid  = 7.08
# a little better, but not a ton? 

summary(glmm_bytest$LocVSmell)
summary(glmm.nb_bytest$LocVSmell)

library(RVAideMemoire)
overdisp.glmer(glmm_bytest$SoundVSmell)
overdisp.glmer(glmm.nb_bytest$SoundVSmell)
#ya, the negative binomial is pretty solid. (1.15 ratio resid deviance on df)

summary(glmm_bytest$SoundVSmell)
summary(glmm.nb_bytest$SoundVSmell)


```


```{r}


glmm_bytest$LocVSmell@optinfo
#glmer/emmeans doesn't like reading the data this way, so will use the split data sets (SvSM, LvSm, LvSo:)
# family = quasipoisson
# other ways?
#standard errors wil get bigger
# explain why I used quasipoisson
# How weird would residuals be if I modelled as linear
# just interpret the coefficient estimates


#tests: 
#are my data overdispersed?
install.packages(AER)
library(AER)
View(LvSo)
LvSo_glm<-  glm(visits_counts ~ cue + cue:Species , family= "poisson", data = LvSo)
dispersiontest(LvSo_glm) 

#ya, data is way overdispersed, better fit with ??



##11.23.20: things to figure out. 
#- How to decide which data to use. Formal way to find if proportion data is better than counts. Or another way to normalize? 
#- What is up with Handel? Did he really visit 55 times?
#- How to decide if Species was an important factor? anova with and without? emmeans? Look at tutorial?
#  OK to use glmms when data are overdispersed? And if no, how to transform? what to use? 
#- Then, If I do use glmms, I should also run models seperately for each spp. 

```


```{r}
########
#plotting the two species, # of counts to each cue:
hist_AJ_Lopho_counts <- ggplot(m_Alltests, aes(visits_counts, fill = Species)) +
  geom_histogram() +
  facet_grid(cols= vars (Species), margins=TRUE, scales="free_y", rows=vars(Test))

hist_AJ_Lopho_counts 
#pretty similar in overall number of visits, but Lophos have more variance

################
#plotting the two species, proportion of visits to each platform

hist_AJ_Lopho_prop  <- ggplot(m_Alltests, aes(visits_prop, fill = Species)) +
  geom_histogram() +
 # scale_x_log10() +
  facet_grid(cols= vars (Species), margins=TRUE, scales="free_y", rows=vars(Test))
hist_AJ_Lopho_prop 
#just a really weird distribution

#################
#proportions of each bat/ test
#free_x lets it drop IDs that don't exist in one facet or another
prop_individual_bat_choices_bar <- ggplot(data = m_Alltests, aes(x= Bat.ID, y= visits_prop, fill =cue))+
geom_bar(position="fill", stat="identity") +
theme(axis.text.x = element_text(angle = 90, size = 5)) +
facet_grid(cols= vars (Species),  rows=vars(Test), scales = "free_x")
prop_individual_bat_choices_bar 
#ggsave("prop_individual_bat_choices_bar.jpg")
#ggsave("prop_individual_bat_choices_bar.pdf")

#counts each bat/test
counts_individual_bat_choices_bar <- ggplot(data = m_Alltests, aes(x= Bat.ID, y= visits_counts, fill =cue))+
geom_bar(position="stack", stat="identity") +
theme(axis.text.x = element_text(angle = 90, size = 5)) +
facet_grid(cols= vars (Species),  rows=vars(Test), scales = "free_x")
counts_individual_bat_choices_bar
#ggsave("count_individual_bat_choices_bar.jpg")
#ggsave("count_individual_bat_choices_bar.pdf")


```

### GLMMs distributions
```{r}
#messing around with finding the best distribution
#quasipoisson? 
#zero-inflated?
# Negative binomial?

library(fitdistrplus)


descdist(SvSm$visits_prop) #check distribution of response variable 1
fit.gamma <- fitdist(SvSm$visits_prop, distr = "gamma", method = "mme")
plot(fit.gamma)
descdist(SvSm$visits_counts) #check distribution of response variable 2
fit.gamma2 <- fitdist(SvSm$visits_counts, distr = "gamma", method = "mme")
plot(fit.gamma2)

library(glmmTMB)
#just trying to figure out a family/ distribution that works. #I've learned nothing. ne

SvSm_glmm_nb<-  glmmTMB(visits_prop ~ cue + cue:Species + (1|Bat.ID), family=list(family="nbinom2",link="log"), data = SvSm)
summary(SvSm_glmm_nb)

SvSm_glmm<-  glmer(visits_counts ~ cue + cue:Species + (1|Bat.ID), family= poisson, data = SvSm)
summary(SvSm_glmm)

aov(SvSm_glmm_nb, SvSm_glmm)

SvSm_glmm2<-  glmer(visits_prop+1 ~ cue + cue:Species + (1|Bat.ID), family= Gamma, data = SvSm)
summary(SvSm_glmm2)


```

###GLMMS and ANOVA, Comparing model factors
```{r}
# I don't totally trust this bc the model fits all suck
#Sound v Smell v neither: comparing presence or absence of species interaction, does the species interaction explain sig amounts of variance: 

#poisson

#just effect of cue
SvSm_glmm_cueonly<-  glmer(visits_counts ~ cue  + (1|Bat.ID), family= "poisson", data = SvSm)
summary(SvSm_glmm_cueonly)

# main effect of cue and interaction with species. This one makes most experimental sense perhaps: just relevant variables
SvSm_glmm<-  glmer(visits_counts ~ cue + cue:Species + (1|Bat.ID), family= "poisson", data = SvSm)
summary(SvSm_glmm)

#Main effect of cue, species, no interaction
SvSm_glmm_sp<-  glmer(visits_counts ~ cue + Species + (1|Bat.ID), family= "poisson", data = SvSm)

# Main effects and  interactions (including main effect of Species- a way to normalize without proportions?)
SvSm_glmm_all<-  glmer(visits_counts ~ cue*Species + (1|Bat.ID), family= "poisson", data = SvSm)
summary(SvSm_glmm_all)

#ANOVA comparing models::
SvSm_Anova_models <- anova(SvSm_glmm_cueonly, SvSm_glmm, SvSm_glmm_sp, SvSm_glmm_all)
SvSm_Anova_models
#including main effect of Species does nothing for this model. AIC/ everything exactly the same. 
##############


emmeans(SvSm_glmm, pairwise ~cue )
emmeans(SvSm_glmm, pairwise ~cue | Species )

emmip(SvSm_glmm,  Species ~ cue)

#Loc v Smell
LvSm_glmm<-  glmer(visits_counts ~ cue + cue:Species + (1|Bat.ID), family= "poisson", data = LvSm)
summary(LvSm_glmm)
emmeans(LvSm_glmm, pairwise ~cue)
emmip(LvSm_glmm,  Species ~ cue)

#Loc v Sound
LvSo_glmm<-  glmer(log(visits_counts+1) ~ cue + cue:Species + (1|Bat.ID), family= "poisson", data = LvSo)
summary(LvSo_glmm)
emmip(LvSo_glmm,  Species ~ cue)
emmeans(LvSo_glmm, pairwise ~cue)






#how to say if factor (species) is significant? If the model is a significantly better fit? 
#don't trust this totally bc of diffs in visits (?)
LvSo_nSp <- glmer(visits_counts ~ cue + (1|Bat.ID), family= "poisson", data = LvSo)
check_overdispersion(LvSo_glmm)
LvSo_glmm

anova(LvSo_nSp, LvSo_glmm)


```


````{r}
emmeans(SvSm_glmm, pairwise ~cue )
help("models", package = "emmeans")

 #11.23/20 real quick ran this... idk
##11.20.20 : ended here: performed the GLMM for the interaction model. Left off trying 








## copypasta #####################
library(dplyr)
library(broom)
#trying to find nice way to do this all in one command. These don't work 
result <- by(m_Alltests, m_Alltests$Test, 
    function(x) glmer(x$visits_counts ~ x$cue* x$Species + (1|x$Bat.ID), family= "poisson"))

SvSm_glmm <- m_Alltests %>% group_by(Test) %>% do(tidy(glmer(.$visits_counts ~ .$cue*.$Species + (1|Bat.ID), family= "poisson")))
#not tidy


result <- by(data, data$Product_type, 
    function(x) t.test(x$Price_Online, x$Price_offline, mu=0, alt="two.sided", paired = TRUE, conf.level = 0.99))

test<- data %>% 
  group_by(factor_var) %>% 
  do(as.data.frame(weighted.sd(x=.$index_var,weight=.$weight_var)))
test

vg_pct_visits <-LocVSound_AJ_L %>% group_by(Species) %>%
      summarise(avg_sound = mean(pct_visits_sound, na.rm=TRUE)*100, avg_loc= mean(pct_visits_loc, na.rm=TRUE)* 100 ,avg_neither = mean(pct_visits_neither, na.rm=TRUE)*100 )
Avg_pct_visits


```



###PLOT CORNER#####
```{r}
#plot controls
width = zz<-  3.5

```













## plotting confidence intervals for pct and % visits to platforms, LvS 
```{r}
#LvS_pct_CI$Species <- factor(LvS_pct_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum")) #need to do this for plot legends to say full name

#LvS_count_CI$Species <- factor(LvS_count_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum"))


pd = position_dodge(0.5) # move bars .05 to the left and right

#proportion plot
LvS_pct_CI_p <- ggplot(data = LvS_pct_CI, aes(x=variable, y = mean, colour = Species))
LvS_pct_CI_p <- LvS_pct_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvS_pct_CI_p <- LvS_pct_CI_p + geom_point( position = pd, shape=18, size = 3)
LvS_pct_CI_p <- LvS_pct_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvS_pct_CI_p <- LvS_pct_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_sound" = "Sound",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
LvS_pct_CI_p <- LvS_pct_CI_p + xlab("Cues")
LvS_pct_CI_p <- LvS_pct_CI_p + ylab("Mean proportion of visits")
LvS_pct_CI_p <- LvS_pct_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))


LvS_pct_CI_p                    
#ggsave("LvS_pct_CI_p.pdf"  )

#count plot
LvS_count_CI_p <- ggplot(data = LvS_count_CI, aes(x=variable, y = mean, colour = Species))
LvS_count_CI_p <- LvS_count_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvS_count_CI_p <- LvS_count_CI_p + geom_point( position = pd, shape=18, size = 3)
LvS_count_CI_p <- LvS_count_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvS_count_CI_p <- LvS_count_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_sound" = "Sound",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
LvS_count_CI_p <- LvS_count_CI_p + xlab("Cues")
LvS_count_CI_p <- LvS_count_CI_p + ylab("Mean number of visits")
LvS_count_CI_p <- LvS_count_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))

LvS_count_CI_p 

#ggsave("LvS_count_CI_p.pdf"  )

```
#### Plotting % of visits to the different platforms, LvS
```{r}
# remove "legend.position="none"," if you want to add the legend back in. 

LocVSound_bar <- ggplot(data =mLocVSound, aes(x = variable, y = value))
LocVSound_bar <- LocVSound_bar + geom_boxplot(aes(fill=Species))
LocVSound_bar <- LocVSound_bar + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSound_bar <- LocVSound_bar + theme(legend.position="none", panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSound_bar <- LocVSound_bar + xlab("Cues")
LocVSound_bar <- LocVSound_bar + ylab("Proportion of total visits")
LocVSound_bar <- LocVSound_bar + scale_x_discrete(labels=c("pct_visits_loc" = "L+S-", "pct_visits_sound" = "L-S+",
                              "pct_visits_neither" = "L-S-" ))  # Relabelling X axis
#LocVSound_bar <- LocVSound_bar + scale_fill_discrete(labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSound_bar <- LocVSound_bar + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
#LocVSound_bar <- LocVSound_bar 

LocVSound_bar


#ggsave("LocVSound_pcts_nolegend.pdf"  )
```


#### Plotting absolute number of visits to the different platforms, LvS
```{r}
LocVSound_bar_cnts <- ggplot(data =mLocVSound_cnts, aes(x = variable, y = value))
LocVSound_bar_cnts <- LocVSound_bar_cnts + geom_boxplot(aes(fill=Species))
LocVSound_bar_cnts <- LocVSound_bar_cnts + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSound_bar_cnts <- LocVSound_bar_cnts + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSound_bar_cnts <- LocVSound_bar_cnts + xlab("Cues")
LocVSound_bar_cnts <- LocVSound_bar_cnts + ylab("Number of visits")
LocVSound_bar_cnts <- LocVSound_bar_cnts + scale_x_discrete(labels=c("visits_loc" = "Location", "visits_sound" = "Sound",
                              "visits_neither" = "Neither" ))  # Relabelling X axis
LocVSound_bar_cnts <- LocVSound_bar_cnts + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSound_bar_cnts

#ggsave("LocVSound_cnts.pdf"  )
```

#### Plot first visits, LvS
```{r}
First_visits_LvS_p <- ggplot(data =first_visits_LvS_fp, aes(x = Cue, y = Visits, fill = Species ))
First_visits_LvS_p <- First_visits_LvS_p + geom_bar(stat = "identity", position=position_dodge()) # need stat = identity bc just not jsut counting occurances in datasheet

First_visits_LvS_p  <- First_visits_LvS_p  + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
First_visits_LvS_p  <- First_visits_LvS_p  + scale_x_discrete( labels=c("location" = "Location", "sound" = "Sound","neither" = "Neither"))  # Relabelling X axis #rearrange bars
First_visits_LvS_p  <- First_visits_LvS_p  + xlab("Cues")
First_visits_LvS_p  <- First_visits_LvS_p  + ylab("Number of bats that visited cue first")

First_visits_LvS_p  <- First_visits_LvS_p  + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))

First_visits_LvS_p

  #ggsave("Loc_v_sound_first_visit.pdf"  )
 # rm(First_visits_p)
```

## plotting confidence intervals for pct and % visits to platforms , LvSm
```{r}
#LvSm_pct_CI$Species <- factor(LvSm_pct_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum")) #need to do this for plot legends to say full name

#LvSm_count_CI$Species <- factor(LvSm_count_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum"))


pd = position_dodge(0.5) # move bars .05 to the left and right

#proportion plot
LvSm_pct_CI_p <- ggplot(data = LvSm_pct_CI, aes(x=variable, y = mean, colour = Species))
LvSm_pct_CI_p <- LvSm_pct_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvSm_pct_CI_p <- LvSm_pct_CI_p + geom_point( position = pd, shape=18, size = 3)
LvSm_pct_CI_p <- LvSm_pct_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
LvSm_pct_CI_p <- LvSm_pct_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvSm_pct_CI_p <- LvSm_pct_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
LvSm_pct_CI_p <- LvSm_pct_CI_p + xlab("Cues")
LvSm_pct_CI_p <- LvSm_pct_CI_p + ylab("Mean proportion of visits")
LvSm_pct_CI_p <- LvSm_pct_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LvSm_pct_CI_p                    

#ggsave("LvSm_pct_CI_p.pdf"  )

#count plot
LvSm_count_CI_p <- ggplot(data = LvSm_count_CI, aes(x=variable, y = mean, colour = Species))
LvSm_count_CI_p <- LvSm_count_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvSm_count_CI_p <- LvSm_count_CI_p + geom_point( position = pd, shape=18, size = 3)
LvSm_count_CI_p <- LvSm_count_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
LvSm_count_CI_p <- LvSm_count_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvSm_count_CI_p <- LvSm_count_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
LvSm_count_CI_p <- LvSm_count_CI_p + xlab("Cues")
LvSm_count_CI_p <- LvSm_count_CI_p + ylab("Mean number of visits")
LvSm_count_CI_p <- LvSm_count_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LvSm_count_CI_p 

#ggsave("LvSm_count_CI_p.pdf"  )
```

#### Plotting % of visits to the different platforms, LvSm
```{r}
LocVSmell_bar <- ggplot(data =mLocVSmell, aes(x = variable, y = value))
LocVSmell_bar <- LocVSmell_bar + geom_boxplot(aes(fill=Species))
LocVSmell_bar <- LocVSmell_bar + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSmell_bar <- LocVSmell_bar + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSmell_bar <- LocVSmell_bar + xlab("Cues")
LocVSmell_bar <- LocVSmell_bar + ylab("Proportion of total visits")
LocVSmell_bar <- LocVSmell_bar + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
LocVSmell_bar <- LocVSmell_bar +  scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSmell_bar

#ggsave("LocVSmell_pct.pdf" )
```

#### Plotting absolute number of visits to the different platforms, LvSm

```{r}
LocVSmell_bar_cnts <- ggplot(data =mLocVSmell_cnts, aes(x = variable, y = value))
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + geom_boxplot(aes(fill=Species))
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + xlab("Cues")
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + ylab("Number of visits")
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + scale_x_discrete(labels=c("visits_loc" = "Location", "visits_smell" = "Smell",
                              "visits_neither" = "Neither" ))  # Relabelling X axis
LocVSmell_bar_cnts <- LocVSmell_bar_cnts +  scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSmell_bar_cnts

#ggsave("LocVSmell_cnts.pdf"  )
```

#### Plot first visits
```{r}
First_visits_LvSm_p <- ggplot(data =first_visits_LvSm_fp, aes(x = Cue, y = Visits, fill = Species ))
First_visits_LvSm_p <- First_visits_LvSm_p + geom_bar(stat = "identity", position=position_dodge()) # need stat = identity bc just not jsut counting occurances in datasheet

First_visits_LvSm_p  <- First_visits_LvSm_p  + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
First_visits_LvSm_p  <- First_visits_LvSm_p  + scale_x_discrete( labels=c("location" = "Location", "smell" = "Smell","neither" = "Neither"))  # Relabelling X axis #rearrange bars
First_visits_LvSm_p  <- First_visits_LvSm_p  + xlab("Cues")
First_visits_LvSm_p  <- First_visits_LvSm_p  + ylab("Number of bats that visited cue first")
First_visits_LvSm_p  <- First_visits_LvSm_p  + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum", "T" = "T. cirrhosus"))

First_visits_LvSm_p

  #ggsave("Loc_v_smell_first_visit.pdf"  )
 # rm(First_visits_LvSm_p)
```

###Sound v Smell####

## plotting confidence intervals for pct and % visits to platforms 
```{r}
#SovSm_pct_CI$Species <- factor(SovSm_pct_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum")) #need to do this for plot legends to say full name

#SovSm_count_CI$Species <- factor(SovSm_count_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum"))


pd = position_dodge(0.5) # move bars .05 to the left and right

#proportion plot
SovSm_pct_CI_p <- ggplot(data = SovSm_pct_CI, aes(x=variable, y = mean, colour = Species))
SovSm_pct_CI_p <- SovSm_pct_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
SovSm_pct_CI_p <- SovSm_pct_CI_p + geom_point( position = pd, shape=18, size = 3)
SovSm_pct_CI_p <- SovSm_pct_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
SovSm_pct_CI_p <- SovSm_pct_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

SovSm_pct_CI_p <- SovSm_pct_CI_p + scale_x_discrete(labels=c("pct_visits_sound" = "Sound", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
SovSm_pct_CI_p <- SovSm_pct_CI_p + xlab("Cues")
SovSm_pct_CI_p <- SovSm_pct_CI_p + ylab("Mean proportion of visits")
SovSm_pct_CI_p <- SovSm_pct_CI_p +  scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SovSm_pct_CI_p                    
#ggsave("SovSm_pct_CI_p.pdf"  )

#count plot
SovSm_count_CI_p <- ggplot(data = SovSm_count_CI, aes(x=variable, y = mean, colour = Species))
SovSm_count_CI_p <- SovSm_count_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
SovSm_count_CI_p <- SovSm_count_CI_p + geom_point( position = pd, shape=18, size = 3)
SovSm_count_CI_p <- SovSm_count_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
SovSm_count_CI_p <- SovSm_count_CI_p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

SovSm_count_CI_p <- SovSm_count_CI_p + scale_x_discrete(labels=c("pct_visits_sound" = "Sound", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
SovSm_count_CI_p <- SovSm_count_CI_p + xlab("Cues")
SovSm_count_CI_p <- SovSm_count_CI_p + ylab("Mean proportion of visits")
SovSm_count_CI_p <- SovSm_count_CI_p +  scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SovSm_count_CI_p   

#ggsave("SovSm_count_CI_p.pdf"  )

```

#### Plotting % of visits to the different platforms
```{r}
SoundVSmell_bar <- ggplot(data =mSoundVSmell, aes(x = variable, y = value))
SoundVSmell_bar <- SoundVSmell_bar + geom_boxplot(aes(fill=Species))
SoundVSmell_bar <- SoundVSmell_bar + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
SoundVSmell_bar <- SoundVSmell_bar + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
SoundVSmell_bar <- SoundVSmell_bar + xlab("Cues")
SoundVSmell_bar <- SoundVSmell_bar + ylab("Proportion of total visits")
SoundVSmell_bar <- SoundVSmell_bar + scale_x_discrete(labels=c("pct_visits_sound" = "Sound", "pct_visits_smell" = "Smell",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
SoundVSmell_bar <- SoundVSmell_bar + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SoundVSmell_bar

#ggsave("SoundVSmell_pct.pdf"  )
```

#### Plotting absolute number of visits to the different platforms, SovSm
```{r}
SoundVSmell_bar_cnts <- ggplot(data =mSoundVSmell_cnts, aes(x = variable, y = value))
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + geom_boxplot(aes(fill=Species))
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + xlab("Cues")
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + ylab("Number of visits")
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + scale_x_discrete(labels=c("visits_sound" = "Sound", "visits_smell" = "Smell",
                              "visits_neither" = "Neither" ))  # Relabelling X axis
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SoundVSmell_bar_cnts

#ggsave("SoundVSmell_cnts.pdf"  )
```

#### Plot first visits, SovSm
```{r}
First_visits_SvSm_p <- ggplot(data =first_visits_SvSm_fp, aes(x = Cue, y = Visits, fill = Species ))
First_visits_SvSm_p <- First_visits_SvSm_p + geom_bar(stat = "identity", position=position_dodge()) # need stat = identity bc just not jsut counting occurances in datasheet

First_visits_SvSm_p  <- First_visits_SvSm_p  + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
First_visits_SvSm_p  <- First_visits_SvSm_p  + scale_x_discrete( labels=c("sound" = "Sound", "smell" = "Smell","neither" = "Neither"))  # Relabelling X axis #rearrange bars
First_visits_SvSm_p  <- First_visits_SvSm_p  + xlab("Cues")
First_visits_SvSm_p  <- First_visits_SvSm_p  + ylab("Number of bats that visited cue first")
First_visits_SvSm_p  <- First_visits_SvSm_p  + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))

First_visits_SvSm_p

  #ggsave("Sound_v_smell_first_visit.pdf"  )
 # rm(First_visits_SvSm_p)
```





###SET WITH NO LEGENDS










```{r}
#plot controls
#width = 
  zz<-  3
#height= 
  hh <- 3

```



## plotting confidence intervals for pct and % visits to platforms, LvS 
```{r}
#LvS_pct_CI$Species <- factor(LvS_pct_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum")) #need to do this for plot legends to say full name

#LvS_count_CI$Species <- factor(LvS_count_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum"))


pd = position_dodge(0.5) # move bars .05 to the left and right

#proportion plot
LvS_pct_CI_p <- ggplot(data = LvS_pct_CI, aes(x=variable, y = mean, colour = Species))
LvS_pct_CI_p <- LvS_pct_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvS_pct_CI_p <- LvS_pct_CI_p + geom_point( position = pd, shape=18, size = 3)
LvS_pct_CI_p <- LvS_pct_CI_p +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvS_pct_CI_p <- LvS_pct_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = "Location", "pct_visits_sound" = "Sound",
                              "pct_visits_neither" = "Neither" ))  # Relabelling X axis
LvS_pct_CI_p <- LvS_pct_CI_p + xlab("Cues")
LvS_pct_CI_p <- LvS_pct_CI_p + ylab("Mean proportion of visits")
LvS_pct_CI_p <- LvS_pct_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))


LvS_pct_CI_p                    
#ggsave("LvS_pct_CI_p.jpg", width = zz  )

#count plot
LvS_count_CI_p <- ggplot(data = LvS_count_CI, aes(x=variable, y = mean, colour = Species))
LvS_count_CI_p <- LvS_count_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvS_count_CI_p <- LvS_count_CI_p + geom_point( position = pd, shape=18, size = 3)
LvS_count_CI_p <- LvS_count_CI_p +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvS_count_CI_p <- LvS_count_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = "L+S-", "pct_visits_sound" = "L-S+",
                              "pct_visits_neither" = "L-S-"  ))  # Relabelling X axis
LvS_count_CI_p <- LvS_count_CI_p + xlab("Cues")
LvS_count_CI_p <- LvS_count_CI_p + ylab("Mean number of visits")
LvS_count_CI_p <- LvS_count_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))

LvS_count_CI_p 

#ggsave("LvS_count_CI_p.jpg", width = zz  )

```
#### Plotting % of visits to the different platforms, LvS
```{r}
# expression(paste( L^"+"~S^"-"))  # way to get superscripts for +- (quote not needed for #s)
# expression(L^{+}~S^{-})
# ~ = space
#[] = subscript
#^ = superscript 

LocVSound_bar <- ggplot(data =mLocVSound, aes(x = variable, y = value))
LocVSound_bar <- LocVSound_bar + geom_boxplot(aes(fill=Species))
LocVSound_bar <- LocVSound_bar + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSound_bar <- LocVSound_bar +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSound_bar <- LocVSound_bar + xlab("Cues")
LocVSound_bar <- LocVSound_bar + ylab("Proportion of total visits")
LocVSound_bar <- LocVSound_bar + scale_x_discrete(labels=c("pct_visits_loc" = expression(paste( L^"+"~S^"-")), "pct_visits_sound" = expression(paste( L^"-"~S^"+")),
                              "pct_visits_neither" = expression(paste( L^"-"~S^"-")) ))  # Relabelling X axis
#LocVSound_bar <- LocVSound_bar + scale_fill_discrete(labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSound_bar <- LocVSound_bar + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSound_bar

# ggsave("LocVSound_nolegend_pcts1.jpg", width = zz , height = hh)

```


#### Plotting absolute number of visits to the different platforms, LvS
```{r}
LocVSound_bar_cnts <- ggplot(data =mLocVSound_cnts, aes(x = variable, y = value))
LocVSound_bar_cnts <- LocVSound_bar_cnts + geom_boxplot(aes(fill=Species))
LocVSound_bar_cnts <- LocVSound_bar_cnts + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSound_bar_cnts <- LocVSound_bar_cnts +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSound_bar_cnts <- LocVSound_bar_cnts + xlab("Cues")
LocVSound_bar_cnts <- LocVSound_bar_cnts + ylab("Number of visits")
LocVSound_bar_cnts <- LocVSound_bar_cnts + scale_x_discrete(labels=c("pct_visits_loc" = expression(paste( L^"+"~S^"-")), "pct_visits_sound" = expression(paste( L^"-"~S^"+")),
                              "pct_visits_neither" = expression(paste( L^"-"~S^"-")) ))  # Relabelling X axis
LocVSound_bar_cnts <- LocVSound_bar_cnts + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSound_bar_cnts

#ggsave("LocVSound_cnts.jpg", width = zz , height = hh )
```

#### Plot first visits, LvS
```{r}
First_visits_LvS_p <- ggplot(data =first_visits_LvS_fp, aes(x = Cue, y = Visits, fill = Species ))
First_visits_LvS_p <- First_visits_LvS_p + geom_bar(stat = "identity", position=position_dodge()) # need stat = identity bc just not jsut counting occurances in datasheet

First_visits_LvS_p  <- First_visits_LvS_p  +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
First_visits_LvS_p  <- First_visits_LvS_p  + scale_x_discrete( labels=c("location" = expression(paste( L^"+"~S^"-")), "sound" = expression(paste( L^"-"~S^"+")),
                              "neither" = expression(paste( L^"-"~S^"-")) ))  # Relabelling X axis #rearrange bars
First_visits_LvS_p  <- First_visits_LvS_p  + xlab("Cues")
First_visits_LvS_p  <- First_visits_LvS_p  + ylab("Number of bats that visited cue first")

First_visits_LvS_p  <- First_visits_LvS_p  + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))

First_visits_LvS_p

  #ggsave("Loc_v_sound_first_visit.jpg", width = zz, height = hh )
 # rm(First_visits_p)
```

## plotting confidence intervals for pct and % visits to platforms , LvSm
```{r}
#LvSm_pct_CI$Species <- factor(LvSm_pct_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum")) #need to do this for plot legends to say full name

#LvSm_count_CI$Species <- factor(LvSm_count_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum"))

# labelling the X axis, using L+O- system
# labels=c("pct_visits_loc" = expression(paste( L^"+"~O^"-")), "pct_visits_smell" = expression(paste( L^"-"~O^"+")), "pct_visits_neither" = expression(paste( L^"-"~O^"-")) )

pd = position_dodge(0.5) # move bars .05 to the left and right

#proportion plot
LvSm_pct_CI_p <- ggplot(data = LvSm_pct_CI, aes(x=variable, y = mean, colour = Species))
LvSm_pct_CI_p <- LvSm_pct_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvSm_pct_CI_p <- LvSm_pct_CI_p + geom_point( position = pd, shape=18, size = 3)
LvSm_pct_CI_p <- LvSm_pct_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
LvSm_pct_CI_p <- LvSm_pct_CI_p +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvSm_pct_CI_p <- LvSm_pct_CI_p + scale_x_discrete(labels=c("pct_visits_loc" = expression(paste( L^"+"~O^"-")), "pct_visits_smell" = expression(paste( L^"-"~O^"+")), "pct_visits_neither" = expression(paste( L^"-"~O^"-")) ))  # Relabelling X axis
LvSm_pct_CI_p <- LvSm_pct_CI_p + xlab("Cues")
LvSm_pct_CI_p <- LvSm_pct_CI_p + ylab("Mean proportion of visits")
LvSm_pct_CI_p <- LvSm_pct_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LvSm_pct_CI_p                    

#ggsave("LvSm_pct_CI_p.jpg", width = zz, height = hh  )

#count plot
LvSm_count_CI_p <- ggplot(data = LvSm_count_CI, aes(x=variable, y = mean, colour = Species))
LvSm_count_CI_p <- LvSm_count_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
LvSm_count_CI_p <- LvSm_count_CI_p + geom_point( position = pd, shape=18, size = 3)
#LvSm_count_CI_p <- LvSm_count_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
LvSm_count_CI_p <- LvSm_count_CI_p +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

LvSm_count_CI_p <- LvSm_count_CI_p + scale_x_discrete(labels=c(labels=c("pct_visits_loc" = expression(paste( L^"+"~O^"-")), "pct_visits_smell" = expression(paste( L^"-"~O^"+")), "pct_visits_neither" = expression(paste( L^"-"~O^"-")) )))  # Relabelling X axis
LvSm_count_CI_p <- LvSm_count_CI_p + xlab("Cues")
LvSm_count_CI_p <- LvSm_count_CI_p + ylab("Mean number of visits")
LvSm_count_CI_p <- LvSm_count_CI_p + scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LvSm_count_CI_p 

#ggsave("LvSm_count_CI_p.jpg", width = zz  )
```

#### Plotting % of visits to the different platforms, LvSm
```{r}
LocVSmell_bar <- ggplot(data =mLocVSmell, aes(x = variable, y = value))
LocVSmell_bar <- LocVSmell_bar + geom_boxplot(aes(fill=Species))
LocVSmell_bar <- LocVSmell_bar + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSmell_bar <- LocVSmell_bar +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSmell_bar <- LocVSmell_bar + xlab("Cues")
LocVSmell_bar <- LocVSmell_bar + ylab("Proportion of total visits")
LocVSmell_bar <- LocVSmell_bar + scale_x_discrete(labels=c("pct_visits_loc" = expression(paste( L^"+"~O^"-")), "pct_visits_smell" = expression(paste( L^"-"~O^"+")), "pct_visits_neither" = expression(paste( L^"-"~O^"-")) ))  # Relabelling X axis
LocVSmell_bar <- LocVSmell_bar +  scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSmell_bar

#ggsave("LocVOdor_pct.jpg", width = zz , height = hh)
```

#### Plotting absolute number of visits to the different platforms, LvSm

```{r}
LocVSmell_bar_cnts <- ggplot(data =mLocVSmell_cnts, aes(x = variable, y = value))
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + geom_boxplot(aes(fill=Species))
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
LocVSmell_bar_cnts <- LocVSmell_bar_cnts +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + xlab("Cues")
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + ylab("Number of visits")
LocVSmell_bar_cnts <- LocVSmell_bar_cnts + scale_x_discrete( labels=c("visits_loc" = expression(paste( L^"+"~O^"-")), "visits_smell" = expression(paste( L^"-"~O^"+")), "visits_neither" = expression(paste( L^"-"~O^"-")) ))  # Relabelling X axis
LocVSmell_bar_cnts <- LocVSmell_bar_cnts +  scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
LocVSmell_bar_cnts

#ggsave("LocVSmell_cnts.jpg", width = zz  )
```

#### Plot first visits L v O
```{r}
First_visits_LvSm_p <- ggplot(data =first_visits_LvSm_fp, aes(x = Cue, y = Visits, fill = Species ))
First_visits_LvSm_p <- First_visits_LvSm_p + geom_bar(stat = "identity", position=position_dodge()) # need stat = identity bc just not jsut counting occurances in datasheet

First_visits_LvSm_p  <- First_visits_LvSm_p  +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
First_visits_LvSm_p  <- First_visits_LvSm_p  + scale_x_discrete( labels=c("location" = expression(paste( L^"+"~O^"-")), "smell" = expression(paste( L^"-"~O^"+")), "neither" = expression(paste( L^"-"~O^"-")) ))  # Relabelling X axis #rearrange bars
First_visits_LvSm_p  <- First_visits_LvSm_p  + xlab("Cues")
First_visits_LvSm_p  <- First_visits_LvSm_p  + ylab("Number of bats that visited cue first")
First_visits_LvSm_p  <- First_visits_LvSm_p  + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum", "T" = "T. cirrhosus"))

First_visits_LvSm_p

  #ggsave("Loc_v_odor_first_visit.jpg", width = zz, height = hh  )
 # rm(First_visits_LvSm_p)
```

###Sound v Odor####

## plotting confidence intervals for pct and % visits to platforms 
```{r}
#SovSm_pct_CI$Species <- factor(SovSm_pct_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum")) #need to do this for plot legends to say full name

#SovSm_count_CI$Species <- factor(SovSm_count_CI$Species, levels=c("AJ", "L"), labels = c("A. jamaicensis", "L. silvicolum"))

pd = position_dodge(0.5) # move bars .05 to the left and right

#proportion plot
SovSm_pct_CI_p <- ggplot(data = SovSm_pct_CI, aes(x=variable, y = mean, colour = Species))
SovSm_pct_CI_p <- SovSm_pct_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
SovSm_pct_CI_p <- SovSm_pct_CI_p + geom_point( position = pd, shape=18, size = 3)
SovSm_pct_CI_p <- SovSm_pct_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
SovSm_pct_CI_p <- SovSm_pct_CI_p +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

SovSm_pct_CI_p <- SovSm_pct_CI_p + scale_x_discrete( labels=c("pct_visits_sound" = expression(paste( S^"+"~O^"-")), "pct_visits_smell" = expression(paste(S^"-"~O^"+")), "pct_visits_neither" = expression(paste( S^"-"~O^"-")) ))  # Relabelling X axis
SovSm_pct_CI_p <- SovSm_pct_CI_p + xlab("Cues")
SovSm_pct_CI_p <- SovSm_pct_CI_p + ylab("Mean proportion of visits")
SovSm_pct_CI_p <- SovSm_pct_CI_p +  scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SovSm_pct_CI_p                    
#ggsave("SovSm_pct_CI_p.jpg", width = zz  )

#count plot
SovSm_count_CI_p <- ggplot(data = SovSm_count_CI, aes(x=variable, y = mean, colour = Species))
SovSm_count_CI_p <- SovSm_count_CI_p + geom_errorbar(aes(ymin = low, ymax = high), width =.1, position = pd)
SovSm_count_CI_p <- SovSm_count_CI_p + geom_point( position = pd, shape=18, size = 3)
SovSm_count_CI_p <- SovSm_count_CI_p + scale_fill_discrete(name="My new legend", labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum")) 
SovSm_count_CI_p <- SovSm_count_CI_p +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic

SovSm_count_CI_p <- SovSm_count_CI_p + scale_x_discrete( labels=c("pct_visits_sound" = expression(paste( S^"+"~O^"-")), "pct_visits_smell" = expression(paste( S^"-"~O^"+")), "pct_visits_neither" = expression(paste( S^"-"~O^"-")) ))  # Relabelling X axis
SovSm_count_CI_p <- SovSm_count_CI_p + xlab("Cues")
SovSm_count_CI_p <- SovSm_count_CI_p + ylab("Mean proportion of visits")
SovSm_count_CI_p <- SovSm_count_CI_p +  scale_color_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SovSm_count_CI_p   

#ggsave("SovSm_count_CI_p.jpg", width = zz  )

```

#### Plotting % of visits to the different platforms
```{r}
SoundVSmell_bar <- ggplot(data =mSoundVSmell, aes(x = variable, y = value))
SoundVSmell_bar <- SoundVSmell_bar + geom_boxplot(aes(fill=Species))
SoundVSmell_bar <- SoundVSmell_bar + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
SoundVSmell_bar <- SoundVSmell_bar +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
SoundVSmell_bar <- SoundVSmell_bar + xlab("Cues")
SoundVSmell_bar <- SoundVSmell_bar + ylab("Proportion of total visits")
SoundVSmell_bar <- SoundVSmell_bar + scale_x_discrete( labels=c("pct_visits_sound" = expression(paste( S^"+"~O^"-")), "pct_visits_smell" = expression(paste( S^"-"~O^"+")), "pct_visits_neither" = expression(paste( S^"-"~O^"-")) ))  # Relabelling X axis
SoundVSmell_bar <- SoundVSmell_bar + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SoundVSmell_bar

#ggsave("Sound_v_Odor_pct.jpg", width = zz , height = hh )
```

#### Plotting absolute number of visits to the different platforms, SovSm
```{r}
SoundVSmell_bar_cnts <- ggplot(data =mSoundVSmell_cnts, aes(x = variable, y = value))
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + geom_boxplot(aes(fill=Species))
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + geom_point(position=position_dodge(width=0.75), aes(group=Species), alpha = 1/4) #makes points semi-transparent
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"), legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + xlab("Cues")
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + ylab("Number of visits")
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + scale_x_discrete( labels=c("visits_sound" = expression(paste( S^"+"~O^"-")), "visits_smell" = expression(paste( S^"-"~O^"+")), "visits_neither" = expression(paste( S^"-"~O^"-")) ))  # Relabelling X axis
SoundVSmell_bar_cnts <- SoundVSmell_bar_cnts + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))
SoundVSmell_bar_cnts

#ggsave("SoundVSmell_cnts.jpg", width = zz, height = hh)
```

#### Plot first visits, SovSm
```{r}
First_visits_SvSm_p <- ggplot(data =first_visits_SvSm_fp, aes(x = Cue, y = Visits, fill = Species ))
First_visits_SvSm_p <- First_visits_SvSm_p + geom_bar(stat = "identity", position=position_dodge()) # need stat = identity bc just not jsut counting occurances in datasheet

First_visits_SvSm_p  <- First_visits_SvSm_p  +  theme( legend.position="none",panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text = element_text(colour = "black"),  legend.text = element_text(face = "italic"))  #gets rid of background, makes legend italic
First_visits_SvSm_p  <- First_visits_SvSm_p  + scale_x_discrete( labels=c("sound" = expression(paste( S^"+"~O^"-")), "smell" = expression(paste( S^"-"~O^"+")), "neither" = expression(paste( S^"-"~O^"-")) ))  # Relabelling X axis #rearrange bars
First_visits_SvSm_p  <- First_visits_SvSm_p  + xlab("Cues")
First_visits_SvSm_p  <- First_visits_SvSm_p  + ylab("Number of bats that visited cue first")
First_visits_SvSm_p  <- First_visits_SvSm_p  + scale_fill_manual(values = c(Lo, Art), labels = c("AJ" = "A. jamaicensis", "L" = "L. silvicolum"))

First_visits_SvSm_p

  #ggsave("Sound_v_Odor_first_visit.jpg", width = zz, height = hh  )
 # rm(First_visits_SvSm_p)
```










